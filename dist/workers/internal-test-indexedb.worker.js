(()=>{var e={isDevMode:()=>!1,deepFreezeWhenDevMode:e=>e,tunnelErrorMessage:e=>"RxDB Error-Code "+e+".\n        Error messages are not included in RxDB core to reduce build size.\n        "};function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function n(e){var n=function(e,n){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,n||"default");if("object"!=t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==t(n)?n:n+""}function r(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,n(o.key),o)}}function o(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function i(e,t){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},i(e,t)}function s(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,i(e,t)}function a(e){return a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},a(e)}function c(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(c=function(){return!!e})()}function u(e){var t="function"==typeof Map?new Map:void 0;return u=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return function(e,t,n){if(c())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,t);var o=new(e.bind.apply(e,r));return n&&i(o,n.prototype),o}(e,arguments,a(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),i(n,e)},u(e)}function l(e,t,n){return"RxError ("+t+"):\n"+e+"\n"+function(e){var t="";return 0===Object.keys(e).length?t:(t+="Given parameters: {\n",t+=Object.keys(e).map((t=>{var n="[object Object]";try{n="errors"===t?e[t].map((e=>JSON.stringify(e,Object.getOwnPropertyNames(e)))):JSON.stringify(e[t],(function(e,t){return void 0===t?null:t}),2)}catch(e){}return t+":"+n})).join("\n"),t+="}")}(n)}var h=function(e){function t(t,n,r={}){var o,i=l(n,t,r);return(o=e.call(this,i)||this).code=t,o.message=i,o.url=f(t),o.parameters=r,o.rxdb=!0,o}return s(t,e),t.prototype.toString=function(){return this.message},o(t,[{key:"name",get:function(){return"RxError ("+this.code+")"}},{key:"typeError",get:function(){return!1}}])}(u(Error)),d=function(e){function t(t,n,r={}){var o,i=l(n,t,r);return(o=e.call(this,i)||this).code=t,o.message=i,o.url=f(t),o.parameters=r,o.rxdb=!0,o}return s(t,e),t.prototype.toString=function(){return this.message},o(t,[{key:"name",get:function(){return"RxTypeError ("+this.code+")"}},{key:"typeError",get:function(){return!0}}])}(u(TypeError));function f(e){return"https://rxdb.info/errors.html?console=errors#"+e}function m(e){return"\n You can find out more about this error here: "+f(e)+" "}function p(t,n){return new h(t,e.tunnelErrorMessage(t)+m(t),n)}function v(t,n){return new d(t,e.tunnelErrorMessage(t)+m(t),n)}function y(e){return!(!e||409!==e.status)&&e}var g={409:"document write conflict",422:"schema validation error",510:"attachment data missing"},b=/\./g,w="abcdefghijklmnopqrstuvwxyz";function _(e=10){for(var t="",n=0;n<e;n++)t+=w.charAt(Math.floor(Math.random()*w.length));return t}function x(e){return(e+="").charAt(0).toUpperCase()+e.substr(1)}function k(e){for(;"."===e.charAt(0);)e=e.substr(1);for(;"."===e.slice(-1);)e=e.slice(0,-1);return e}var S=e=>{var t=typeof e;return null!==e&&("object"===t||"function"===t)},I=new Set(["__proto__","prototype","constructor"]),E=new Set("0123456789");function O(e){var t=[],n="",r="start",o=!1;for(var i of e)switch(i){case"\\":if("index"===r)throw new Error("Invalid character in an index");if("indexEnd"===r)throw new Error("Invalid character after an index");o&&(n+=i),r="property",o=!o;break;case".":if("index"===r)throw new Error("Invalid character in an index");if("indexEnd"===r){r="property";break}if(o){o=!1,n+=i;break}if(I.has(n))return[];t.push(n),n="",r="property";break;case"[":if("index"===r)throw new Error("Invalid character in an index");if("indexEnd"===r){r="index";break}if(o){o=!1,n+=i;break}if("property"===r){if(I.has(n))return[];t.push(n),n=""}r="index";break;case"]":if("index"===r){t.push(Number.parseInt(n,10)),n="",r="indexEnd";break}if("indexEnd"===r)throw new Error("Invalid character after an index");default:if("index"===r&&!E.has(i))throw new Error("Invalid character in an index");if("indexEnd"===r)throw new Error("Invalid character after an index");"start"===r&&(r="property"),o&&(o=!1,n+="\\"),n+=i}switch(o&&(n+="\\"),r){case"property":if(I.has(n))return[];t.push(n);break;case"index":throw new Error("Index was not closed");case"start":t.push("")}return t}function D(e,t){if("number"!=typeof t&&Array.isArray(e)){var n=Number.parseInt(t,10);return Number.isInteger(n)&&e[n]===e[t]}return!1}function P(e,t,n){if(Array.isArray(t)&&(t=t.join(".")),!t.includes(".")&&!t.includes("["))return e[t];if(!S(e)||"string"!=typeof t)return void 0===n?e:n;var r=O(t);if(0===r.length)return n;for(var o=0;o<r.length;o++){var i=r[o];if(null==(e=D(e,i)?o===r.length-1?void 0:null:e[i])){if(o!==r.length-1)return n;break}}return void 0===e?n:e}function j(e){var t=e.split("."),n=t.length;return 1===n?t=>t[e]:e=>{for(var r=e,o=0;o<n;++o)if(void 0===(r=r[t[o]]))return r;return r}}function C(e){return Object.assign({},e)}function R(e,t=!1){if(!e)return e;if(!t&&Array.isArray(e))return e.sort(((e,t)=>"string"==typeof e&&"string"==typeof t?e.localeCompare(t):"object"==typeof e?1:-1)).map((e=>R(e,t)));if("object"==typeof e&&!Array.isArray(e)){var n={};return Object.keys(e).sort(((e,t)=>e.localeCompare(t))).forEach((r=>{n[r]=R(e[r],t)})),n}return e}var M=function e(t){if(!t)return t;if(null===t||"object"!=typeof t)return t;if(Array.isArray(t)){for(var n=new Array(t.length),r=n.length;r--;)n[r]=e(t[r]);return n}var o={};for(var i in t)o[i]=e(t[i]);return o};function A(e,t,n){return Object.defineProperty(e,t,{get:function(){return n}}),n}function N(e){return e[e.length-1]}function $(e){return Array.isArray(e)}function B(e){return null!=e}function T(e,t){var n=0,r=-1;for(var o of e){if(!t(o,r+=1))break;n+=1}return n}function q(e,t){var n=t.length;if(0!==n){var r=e.length;e.length=r+t.length;for(var o=0;o<n;++o)e[r+o]=t[o]}}var L=1;function F(){return{lwt:L}}function K(e,t){return P(e,k("properties."+t.replace(b,".properties.")))}function z(e){return"string"==typeof e?e:e.key}function Q(e,t){if("string"==typeof e.primaryKey)return t[e.primaryKey];var n=e.primaryKey;return n.fields.map((e=>{var n=P(t,e);if(void 0===n)throw p("DOC18",{args:{field:e,documentData:t}});return n})).join(n.separator)}function W(e){var t=z((e=C(e)).primaryKey);e.properties=C(e.properties),e.additionalProperties=!1,Object.prototype.hasOwnProperty.call(e,"keyCompression")||(e.keyCompression=!1),e.indexes=e.indexes?e.indexes.slice(0):[],e.required=e.required?e.required.slice(0):[],e.encrypted=e.encrypted?e.encrypted.slice(0):[],e.properties._rev={type:"string",minLength:1},e.properties._attachments={type:"object"},e.properties._deleted={type:"boolean"},e.properties._meta=H,e.required=e.required?e.required.slice(0):[],e.required.push("_deleted"),e.required.push("_rev"),e.required.push("_meta"),e.required.push("_attachments");var n=U(e);q(e.required,n),e.required=e.required.filter((e=>!e.includes("."))).filter(((e,t,n)=>n.indexOf(e)===t)),e.version=e.version||0;var r=e.indexes.map((e=>{var n=$(e)?e.slice(0):[e];return n.includes(t)||n.push(t),"_deleted"!==n[0]&&n.unshift("_deleted"),n}));0===r.length&&r.push(function(e){return["_deleted",e]}(t)),r.push(["_meta.lwt",t]),e.internalIndexes&&e.internalIndexes.map((e=>{r.push(e)}));var o=new Set;return r.filter((e=>{var t=e.join(",");return!o.has(t)&&(o.add(t),!0)})),e.indexes=r,e}var H={type:"object",properties:{lwt:{type:"number",minimum:L,maximum:1e15,multipleOf:.01}},additionalProperties:!0,required:["lwt"]};function U(e){var t=Object.keys(e.properties).filter((t=>e.properties[t].final)),n=z(e.primaryKey);return t.push(n),"string"!=typeof e.primaryKey&&e.primaryKey.fields.forEach((e=>t.push(e))),t}var V=0;function J(){var e=Date.now();(e+=.01)<=V&&(e=V+.01);var t=parseFloat(e.toFixed(2));return V=t,t}function G(e,t){if(!e)throw t||(t=""),new Error("ensureNotFalsy() is falsy: "+t);return e}var Y={bufferSize:1,refCount:!0};function X(e){for(var t="",n=0;n<e.length;n++){var r=e[n];if("-"===r)return parseInt(t,10);t+=r}throw new Error("malformatted revision: "+e)}function Z(e,t){return(t?X(t._rev)+1:1)+"-"+e}var ee=function(e,t){return ee=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},ee(e,t)};function te(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}ee(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function ne(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}function re(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function oe(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function ie(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}function se(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}function ae(e){return this instanceof ae?(this.v=e,this):new ae(e)}function ce(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,o=n.apply(e,t||[]),i=[];return r={},s("next"),s("throw"),s("return",(function(e){return function(t){return Promise.resolve(t).then(e,u)}})),r[Symbol.asyncIterator]=function(){return this},r;function s(e,t){o[e]&&(r[e]=function(t){return new Promise((function(n,r){i.push([e,t,n,r])>1||a(e,t)}))},t&&(r[e]=t(r[e])))}function a(e,t){try{(n=o[e](t)).value instanceof ae?Promise.resolve(n.value.v).then(c,u):l(i[0][2],n)}catch(e){l(i[0][3],e)}var n}function c(e){a("next",e)}function u(e){a("throw",e)}function l(e,t){e(t),i.shift(),i.length&&a(i[0][0],i[0][1])}}function ue(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=oe(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,o){!function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)}(r,o,(t=e[n](t)).done,t.value)}))}}}function le(e){return"function"==typeof e}function he(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var de=he((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function fe(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var me=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var e,t,n,r,o;if(!this.closed){this.closed=!0;var i=this._parentage;if(i)if(this._parentage=null,Array.isArray(i))try{for(var s=oe(i),a=s.next();!a.done;a=s.next())a.value.remove(this)}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}else i.remove(this);var c=this.initialTeardown;if(le(c))try{c()}catch(e){o=e instanceof de?e.errors:[e]}var u=this._finalizers;if(u){this._finalizers=null;try{for(var l=oe(u),h=l.next();!h.done;h=l.next()){var d=h.value;try{ye(d)}catch(e){o=null!=o?o:[],e instanceof de?o=se(se([],ie(o)),ie(e.errors)):o.push(e)}}}catch(e){n={error:e}}finally{try{h&&!h.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}}if(o)throw new de(o)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)ye(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&fe(t,e)},e.prototype.remove=function(t){var n=this._finalizers;n&&fe(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=function(){var t=new e;return t.closed=!0,t}(),e}(),pe=me.EMPTY;function ve(e){return e instanceof me||e&&"closed"in e&&le(e.remove)&&le(e.add)&&le(e.unsubscribe)}function ye(e){le(e)?e():e.unsubscribe()}var ge={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},be={setTimeout:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=be.delegate;return(null==o?void 0:o.setTimeout)?o.setTimeout.apply(o,se([e,t],ie(n))):setTimeout.apply(void 0,se([e,t],ie(n)))},clearTimeout:function(e){var t=be.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function we(e){be.setTimeout((function(){var t=ge.onUnhandledError;if(!t)throw e;t(e)}))}function _e(){}var xe=ke("C",void 0,void 0);function ke(e,t,n){return{kind:e,value:t,error:n}}var Se=null;function Ie(e){if(ge.useDeprecatedSynchronousErrorHandling){var t=!Se;if(t&&(Se={errorThrown:!1,error:null}),e(),t){var n=Se,r=n.errorThrown,o=n.error;if(Se=null,r)throw o}}else e()}var Ee=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,ve(t)&&t.add(n)):n.destination=Me,n}return te(t,e),t.create=function(e,t,n){return new je(e,t,n)},t.prototype.next=function(e){this.isStopped?Re(function(e){return ke("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?Re(ke("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?Re(xe,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(me),Oe=Function.prototype.bind;function De(e,t){return Oe.call(e,t)}var Pe=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){Ce(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){Ce(e)}else Ce(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){Ce(e)}},e}(),je=function(e){function t(t,n,r){var o,i,s=e.call(this)||this;return le(t)||!t?o={next:null!=t?t:void 0,error:null!=n?n:void 0,complete:null!=r?r:void 0}:s&&ge.useDeprecatedNextContext?((i=Object.create(t)).unsubscribe=function(){return s.unsubscribe()},o={next:t.next&&De(t.next,i),error:t.error&&De(t.error,i),complete:t.complete&&De(t.complete,i)}):o=t,s.destination=new Pe(o),s}return te(t,e),t}(Ee);function Ce(e){var t;ge.useDeprecatedSynchronousErrorHandling?(t=e,ge.useDeprecatedSynchronousErrorHandling&&Se&&(Se.errorThrown=!0,Se.error=t)):we(e)}function Re(e,t){var n=ge.onStoppedNotification;n&&be.setTimeout((function(){return n(e,t)}))}var Me={closed:!0,next:_e,error:function(e){throw e},complete:_e},Ae="function"==typeof Symbol&&Symbol.observable||"@@observable";function Ne(e){return e}function $e(e){return 0===e.length?Ne:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var Be=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r,o=this,i=(r=e)&&r instanceof Ee||function(e){return e&&le(e.next)&&le(e.error)&&le(e.complete)}(r)&&ve(r)?e:new je(e,t,n);return Ie((function(){var e=o,t=e.operator,n=e.source;i.add(t?t.call(i,n):n?o._subscribe(i):o._trySubscribe(i))})),i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=Te(t))((function(t,r){var o=new je({next:function(t){try{e(t)}catch(e){r(e),o.unsubscribe()}},error:r,complete:t});n.subscribe(o)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[Ae]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return $e(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=Te(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function Te(e){var t;return null!==(t=null!=e?e:ge.Promise)&&void 0!==t?t:Promise}var qe=he((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),Le=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return te(t,e),t.prototype.lift=function(e){var t=new Fe(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new qe},t.prototype.next=function(e){var t=this;Ie((function(){var n,r;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var o=oe(t.currentObservers),i=o.next();!i.done;i=o.next())i.value.next(e)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}}}))},t.prototype.error=function(e){var t=this;Ie((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var n=t.observers;n.length;)n.shift().error(e)}}))},t.prototype.complete=function(){var e=this;Ie((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=this,r=n.hasError,o=n.isStopped,i=n.observers;return r||o?pe:(this.currentObservers=null,i.push(e),new me((function(){t.currentObservers=null,fe(i,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.hasError,r=t.thrownError,o=t.isStopped;n?e.error(r):o&&e.complete()},t.prototype.asObservable=function(){var e=new Be;return e.source=this,e},t.create=function(e,t){return new Fe(e,t)},t}(Be),Fe=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return te(t,e),t.prototype.next=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)},t.prototype.error=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:pe},t}(Le),Ke=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return te(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){var e=this,t=e.hasError,n=e.thrownError,r=e._value;if(t)throw n;return this._throwIfClosed(),r},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(Le),ze=he((function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}}));function Qe(e){return function(t){if(function(e){return le(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}function We(e,t,n,r,o){return new He(e,t,n,r,o)}var He=function(e){function t(t,n,r,o,i,s){var a=e.call(this,t)||this;return a.onFinalize=i,a.shouldUnsubscribe=s,a._next=n?function(e){try{n(e)}catch(e){t.error(e)}}:e.prototype._next,a._error=o?function(e){try{o(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,a._complete=r?function(){try{r()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,a}return te(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(Ee);function Ue(e,t){return Qe((function(n,r){var o=0;n.subscribe(We(r,(function(n){r.next(e.call(t,n,o++))})))}))}var Ve=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function Je(e){return le(null==e?void 0:e.then)}function Ge(e){return le(e[Ae])}function Ye(e){return Symbol.asyncIterator&&le(null==e?void 0:e[Symbol.asyncIterator])}function Xe(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var Ze="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function et(e){return le(null==e?void 0:e[Ze])}function tt(e){return ce(this,arguments,(function(){var t,n,r;return re(this,(function(o){switch(o.label){case 0:t=e.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,ae(t.read())];case 3:return n=o.sent(),r=n.value,n.done?[4,ae(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,ae(r)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function nt(e){return le(null==e?void 0:e.getReader)}function rt(e){if(e instanceof Be)return e;if(null!=e){if(Ge(e))return o=e,new Be((function(e){var t=o[Ae]();if(le(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(Ve(e))return r=e,new Be((function(e){for(var t=0;t<r.length&&!e.closed;t++)e.next(r[t]);e.complete()}));if(Je(e))return n=e,new Be((function(e){n.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,we)}));if(Ye(e))return ot(e);if(et(e))return t=e,new Be((function(e){var n,r;try{for(var o=oe(t),i=o.next();!i.done;i=o.next()){var s=i.value;if(e.next(s),e.closed)return}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}e.complete()}));if(nt(e))return ot(tt(e))}var t,n,r,o;throw Xe(e)}function ot(e){return new Be((function(t){(function(e,t){var n,r,o,i;return ne(this,void 0,void 0,(function(){var s,a;return re(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=ue(e),c.label=1;case 1:return[4,n.next()];case 2:if((r=c.sent()).done)return[3,4];if(s=r.value,t.next(s),t.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),o={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),r&&!r.done&&(i=n.return)?[4,i.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))})(e,t).catch((function(e){return t.error(e)}))}))}function it(e,t,n,r,o){void 0===r&&(r=0),void 0===o&&(o=!1);var i=t.schedule((function(){n(),o?e.add(this.schedule(null,r)):this.unsubscribe()}),r);if(e.add(i),!o)return i}function st(e,t,n){return void 0===n&&(n=1/0),le(t)?st((function(n,r){return Ue((function(e,o){return t(n,e,r,o)}))(rt(e(n,r)))}),n):("number"==typeof t&&(n=t),Qe((function(t,r){return function(e,t,n,r,o,i,s,a){var c=[],u=0,l=0,h=!1,d=function(){!h||c.length||u||t.complete()},f=function(e){return u<r?m(e):c.push(e)},m=function(e){i&&t.next(e),u++;var a=!1;rt(n(e,l++)).subscribe(We(t,(function(e){null==o||o(e),i?f(e):t.next(e)}),(function(){a=!0}),void 0,(function(){if(a)try{u--;for(var e=function(){var e=c.shift();s?it(t,s,(function(){return m(e)})):m(e)};c.length&&u<r;)e();d()}catch(e){t.error(e)}})))};return e.subscribe(We(t,f,(function(){h=!0,d()}))),function(){null==a||a()}}(t,r,e,n)})))}function at(e){return void 0===e&&(e=1/0),st(Ne,e)}var ct=new Be((function(e){return e.complete()}));function ut(e){return e[e.length-1]}function lt(e){return(t=ut(e))&&le(t.schedule)?e.pop():void 0;var t}function ht(e,t){return"number"==typeof ut(e)?e.pop():t}function dt(e,t){return void 0===t&&(t=0),Qe((function(n,r){n.subscribe(We(r,(function(n){return it(r,e,(function(){return r.next(n)}),t)}),(function(){return it(r,e,(function(){return r.complete()}),t)}),(function(n){return it(r,e,(function(){return r.error(n)}),t)})))}))}function ft(e,t){return void 0===t&&(t=0),Qe((function(n,r){r.add(e.schedule((function(){return n.subscribe(r)}),t))}))}function mt(e,t){if(!e)throw new Error("Iterable cannot be null");return new Be((function(n){it(n,t,(function(){var r=e[Symbol.asyncIterator]();it(n,t,(function(){r.next().then((function(e){e.done?n.complete():n.next(e.value)}))}),0,!0)}))}))}function pt(e,t){if(null!=e){if(Ge(e))return function(e,t){return rt(e).pipe(ft(t),dt(t))}(e,t);if(Ve(e))return function(e,t){return new Be((function(n){var r=0;return t.schedule((function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())}))}))}(e,t);if(Je(e))return function(e,t){return rt(e).pipe(ft(t),dt(t))}(e,t);if(Ye(e))return mt(e,t);if(et(e))return function(e,t){return new Be((function(n){var r;return it(n,t,(function(){r=e[Ze](),it(n,t,(function(){var e,t,o;try{t=(e=r.next()).value,o=e.done}catch(e){return void n.error(e)}o?n.complete():n.next(t)}),0,!0)})),function(){return le(null==r?void 0:r.return)&&r.return()}}))}(e,t);if(nt(e))return function(e,t){return mt(tt(e),t)}(e,t)}throw Xe(e)}function vt(e,t){return t?pt(e,t):rt(e)}function yt(e,t){return Qe((function(n,r){var o=0;n.subscribe(We(r,(function(n){return e.call(t,n,o++)&&r.next(n)})))}))}function gt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return at(1)(vt(e,lt(e)))}function bt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=lt(e);return Qe((function(t,r){(n?gt(e,t,n):gt(e,t)).subscribe(r)}))}var wt={now:function(){return(wt.delegate||Date).now()},delegate:void 0},_t=function(e){function t(t,n,r){void 0===t&&(t=1/0),void 0===n&&(n=1/0),void 0===r&&(r=wt);var o=e.call(this)||this;return o._bufferSize=t,o._windowTime=n,o._timestampProvider=r,o._buffer=[],o._infiniteTimeWindow=!0,o._infiniteTimeWindow=n===1/0,o._bufferSize=Math.max(1,t),o._windowTime=Math.max(1,n),o}return te(t,e),t.prototype.next=function(t){var n=this,r=n.isStopped,o=n._buffer,i=n._infiniteTimeWindow,s=n._timestampProvider,a=n._windowTime;r||(o.push(t),!i&&o.push(s.now()+a)),this._trimBuffer(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){this._throwIfClosed(),this._trimBuffer();for(var t=this._innerSubscribe(e),n=this._infiniteTimeWindow,r=this._buffer.slice(),o=0;o<r.length&&!e.closed;o+=n?1:2)e.next(r[o]);return this._checkFinalizedStatuses(e),t},t.prototype._trimBuffer=function(){var e=this,t=e._bufferSize,n=e._timestampProvider,r=e._buffer,o=e._infiniteTimeWindow,i=(o?1:2)*t;if(t<1/0&&i<r.length&&r.splice(0,r.length-i),!o){for(var s=n.now(),a=0,c=1;c<r.length&&r[c]<=s;c+=2)a=c;a&&r.splice(0,a+1)}},t}(Le);function xt(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!0!==t){if(!1!==t){var o=new je({next:function(){o.unsubscribe(),e()}});return rt(t.apply(void 0,se([],ie(n)))).subscribe(o)}}else e()}function kt(e,t,n){var r,o,i,s,a=!1;return e&&"object"==typeof e?(r=e.bufferSize,s=void 0===r?1/0:r,o=e.windowTime,t=void 0===o?1/0:o,a=void 0!==(i=e.refCount)&&i,n=e.scheduler):s=null!=e?e:1/0,function(e){void 0===e&&(e={});var t=e.connector,n=void 0===t?function(){return new Le}:t,r=e.resetOnError,o=void 0===r||r,i=e.resetOnComplete,s=void 0===i||i,a=e.resetOnRefCountZero,c=void 0===a||a;return function(e){var t,r,i,a=0,u=!1,l=!1,h=function(){null==r||r.unsubscribe(),r=void 0},d=function(){h(),t=i=void 0,u=l=!1},f=function(){var e=t;d(),null==e||e.unsubscribe()};return Qe((function(e,m){a++,l||u||h();var p=i=null!=i?i:n();m.add((function(){0!=--a||l||u||(r=xt(f,c))})),p.subscribe(m),!t&&a>0&&(t=new je({next:function(e){return p.next(e)},error:function(e){l=!0,h(),r=xt(d,o,e),p.error(e)},complete:function(){u=!0,h(),r=xt(d,s),p.complete()}}),rt(e).subscribe(t))}))(e)}}({connector:function(){return new _t(s,t,n)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:a})}function St(e,t){return void 0===t&&(t=Ne),e=null!=e?e:It,Qe((function(n,r){var o,i=!0;n.subscribe(We(r,(function(n){var s=t(n);!i&&e(o,s)||(i=!1,o=s,r.next(n))})))}))}function It(e,t){return e===t}function Et(e=0){return new Promise((t=>setTimeout(t,e)))}Promise.resolve(!0);var Ot=Promise.resolve(!1),Dt=Promise.resolve(null),Pt=Promise.resolve();function jt(e=1e4){return"function"==typeof requestIdleCallback?new Promise((t=>{requestIdleCallback((()=>t()),{timeout:e})})):Et(0)}var Ct=Pt;function Rt(e){var t=e.split("-"),n="RxDB";return t.forEach((e=>{n+=x(e)})),n+="Plugin",new Error("You are using a function which must be overwritten by a plugin.\n        You should either prevent the usage of this function or add the plugin via:\n            import { "+n+" } from 'rxdb/plugins/"+e+"';\n            addRxPlugin("+n+");\n        ")}var Mt={preAddRxPlugin:[],preCreateRxDatabase:[],createRxDatabase:[],preCreateRxCollection:[],createRxCollection:[],createRxState:[],postDestroyRxCollection:[],postRemoveRxCollection:[],preCreateRxSchema:[],createRxSchema:[],preCreateRxQuery:[],prePrepareQuery:[],createRxDocument:[],postCreateRxDocument:[],preCreateRxStorageInstance:[],preStorageWrite:[],preMigrateDocument:[],postMigrateDocument:[],preDestroyRxDatabase:[],postRemoveRxDatabase:[],preReplicationMasterWrite:[],preReplicationMasterWriteDocumentsHandle:[]};function At(e,t){Mt[e].length>0&&Mt[e].forEach((e=>e(t)))}function Nt(e,t){return Promise.all(Mt[e].map((e=>e(t))))}const $t=e=>{e.previousResults.unshift(e.changeEvent.doc),e.keyDocumentMap&&e.keyDocumentMap.set(e.changeEvent.id,e.changeEvent.doc)},Bt=e=>{e.previousResults.push(e.changeEvent.doc),e.keyDocumentMap&&e.keyDocumentMap.set(e.changeEvent.id,e.changeEvent.doc)},Tt=e=>{const t=e.previousResults.shift();e.keyDocumentMap&&t&&e.keyDocumentMap.delete(t[e.queryParams.primaryKey])},qt=e=>{const t=e.previousResults.pop();e.keyDocumentMap&&t&&e.keyDocumentMap.delete(t[e.queryParams.primaryKey])},Lt=e=>{e.keyDocumentMap&&e.keyDocumentMap.delete(e.changeEvent.id);const t=e.queryParams.primaryKey,n=e.previousResults;for(let r=0;r<n.length;r++)if(n[r][t]===e.changeEvent.id){n.splice(r,1);break}},Ft=e=>{const t=e.changeEvent.id,n=e.changeEvent.doc;if(e.keyDocumentMap){if(e.keyDocumentMap.has(t))return;e.keyDocumentMap.set(t,n)}else if(e.previousResults.find((n=>n[e.queryParams.primaryKey]===t)))return;!function(e,t,n,r){var o,i=e.length,s=i-1,a=0;if(0===i)return e.push(t),0;for(;r<=s;)n(o=e[a=r+(s-r>>1)],t)<=0?r=a+1:s=a-1;n(o,t)<=0&&a++,e.splice(a,0,t)}(e.previousResults,n,e.queryParams.sortComparator,0)},Kt=["doNothing","insertFirst","insertLast","removeFirstItem","removeLastItem","removeFirstInsertLast","removeLastInsertFirst","removeFirstInsertFirst","removeLastInsertLast","removeExisting","replaceExisting","alwaysWrong","insertAtSortPosition","removeExistingAndInsertAtSortPosition","runFullQueryAgain","unknownAction"],zt={doNothing:e=>{},insertFirst:$t,insertLast:Bt,removeFirstItem:Tt,removeLastItem:qt,removeFirstInsertLast:e=>{Tt(e),Bt(e)},removeLastInsertFirst:e=>{qt(e),$t(e)},removeFirstInsertFirst:e=>{Tt(e),$t(e)},removeLastInsertLast:e=>{qt(e),Bt(e)},removeExisting:Lt,replaceExisting:e=>{const t=e.changeEvent.doc,n=e.queryParams.primaryKey,r=e.previousResults;for(let o=0;o<r.length;o++)if(r[o][n]===e.changeEvent.id){r[o]=t,e.keyDocumentMap&&e.keyDocumentMap.set(e.changeEvent.id,t);break}},alwaysWrong:e=>{const t={_id:"wrongHuman"+(new Date).getTime()};e.previousResults.length=0,e.previousResults.push(t),e.keyDocumentMap&&(e.keyDocumentMap.clear(),e.keyDocumentMap.set(t._id,t))},insertAtSortPosition:Ft,removeExistingAndInsertAtSortPosition:e=>{Lt(e),Ft(e)},runFullQueryAgain:e=>{throw new Error("Action runFullQueryAgain must be implemented by yourself")},unknownAction:e=>{throw new Error("Action unknownAction should never be called")}};function Qt(e,t){const n=[];for(let r=0,o=e.length;r<o;r+=t)n.push(e.substring(r,r+t));return n}!function(e=6){let t="";const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let r=0;r<e;r++)t+=n.charAt(Math.floor(62*Math.random()))}(4);const Wt=40;function Ht(e){return e.charCodeAt(0)-Wt}function Ut(e){return e[e.length-1]}function Vt(e,t,n){if(Array.isArray(t)&&(t=t.join(".")),!function(e){const t=typeof e;return null!==e&&("object"===t||"function"===t)}(e)||"string"!=typeof t)return void 0===n?e:n;const r=t.split(".");if(0===r.length)return n;for(let t=0;t<r.length;t++){const o=r[t];if(null==(e=Jt(e,o)?t===r.length-1?void 0:null:e[o])){if(t!==r.length-1)return n;break}}return void 0===e?n:e}function Jt(e,t){if("number"!=typeof t&&Array.isArray(e)){const n=Number.parseInt(t,10);return Number.isInteger(n)&&e[n]===e[t]}return!1}const Gt=e=>!!e.queryParams.limit,Yt=e=>1===e.queryParams.limit,Xt=e=>!!(e.queryParams.skip&&e.queryParams.skip>0),Zt=e=>"DELETE"===e.changeEvent.operation,en=e=>"INSERT"===e.changeEvent.operation,tn=e=>"UPDATE"===e.changeEvent.operation,nn=e=>Gt(e)&&e.previousResults.length>=e.queryParams.limit,rn=e=>{const t=e.queryParams.sortFields,n=e.changeEvent.previous,r=e.changeEvent.doc;if(!r)return!1;if(!n)return!0;for(let e=0;e<t.length;e++){const o=t[e];if(Vt(n,o)!==Vt(r,o))return!0}return!1},on=e=>{const t=e.changeEvent.id;if(e.keyDocumentMap)return e.keyDocumentMap.has(t);{const n=e.queryParams.primaryKey,r=e.previousResults;for(let e=0;e<r.length;e++)if(r[e][n]===t)return!0;return!1}},sn=e=>{const t=e.previousResults[0];return!(!t||t[e.queryParams.primaryKey]!==e.changeEvent.id)},an=e=>{const t=Ut(e.previousResults);return!(!t||t[e.queryParams.primaryKey]!==e.changeEvent.id)},cn=e=>{const t=e.changeEvent.previous;if(!t)return!1;const n=e.previousResults[0];return!!n&&(n[e.queryParams.primaryKey]===e.changeEvent.id||e.queryParams.sortComparator(t,n)<0)},un=e=>{const t=e.changeEvent.previous;if(!t)return!1;const n=Ut(e.previousResults);return!!n&&(n[e.queryParams.primaryKey]===e.changeEvent.id||e.queryParams.sortComparator(t,n)>0)},ln=e=>{const t=e.changeEvent.doc;if(!t)return!1;const n=e.previousResults[0];return!!n&&(n[e.queryParams.primaryKey]===e.changeEvent.id||e.queryParams.sortComparator(t,n)<0)},hn=e=>{const t=e.changeEvent.doc;if(!t)return!1;const n=Ut(e.previousResults);return!!n&&(n[e.queryParams.primaryKey]===e.changeEvent.id||e.queryParams.sortComparator(t,n)>0)},dn=e=>{const t=e.changeEvent.previous;return!!t&&e.queryParams.queryMatcher(t)},fn=e=>{const t=e.changeEvent.doc;return!!t&&e.queryParams.queryMatcher(t)},mn=e=>0===e.previousResults.length,pn={0:en,1:tn,2:Zt,3:Gt,4:Yt,5:Xt,6:mn,7:nn,8:sn,9:an,10:rn,11:on,12:cn,13:un,14:ln,15:hn,16:dn,17:fn};let vn;function yn(){return vn||(vn=function(e){const t=new Map,n=2+2*parseInt(e.charAt(0)+e.charAt(1),10),r=Qt(e.substring(2,n),2);for(let e=0;e<r.length;e++){const n=r[e],o=n.charAt(0),i=Ht(n.charAt(1));t.set(o,i)}const o=Qt(e.substring(n,e.length-3),4);for(let e=0;e<o.length;e++){const n=o[e],r=n.charAt(0),i=n.charAt(1),s=n.charAt(2),a=Ht(n.charAt(3));if(!t.has(i))throw new Error("missing node with id "+i);if(!t.has(s))throw new Error("missing node with id "+s);const c={l:a,0:t.get(i),1:t.get(s)};t.set(r,c)}const i=e.slice(-3),s=i.charAt(0),a=i.charAt(1);return{l:Ht(i.charAt(2)),0:t.get(s),1:t.get(a)}}("14a1b,c+d2e5f0g/h.i4j*k-l)m(n6oeh6pnm6qen6ril6snh6tin6ubo9vce9wmh9xns9yne9zmi9{cm9|ad9}cp9~aq9ae9¡bf9¢bq9£cg9¤ck9¥cn9¦nd9§np9¨nq9©nf9ªng9«nm9¬nk9­mr9®ms9¯mt9°mj9±mk9²ml9³mn9´mc8µ³{8¶¯}8·°¤8¸³§8¹mn8º³«8»³m8¼m´4½z²4¾³w4¿zµ4À¯¶4Á°·4Â³º4Ã³¸4Äm¹4Åv¤7Æyn7ÇÀÁ7È~7É¥¤7ÊÃÄ7Ë¨n7Ìº¹7Í­°7Î®m7Ï¯°7Ð±m7Ñ³m7Ò¼m5ÓÄm5Ô¹m5Õ½°5Ö¾m5×¿°5ØÇÏ5ÙÂm5ÚÊÑ5Û±m5Üºm5ÝÌÑ5ÞÕÍ2ß|2à¡u2á£Å2âÖÎ2ã¦Æ2ä©x2åªÆ2æ×Ø2ç|È2è¡¢2é£É2ê¤¥2ëÙÚ2ì¦Ë2í©n2îªn2ïÛÐ2ðÜÝ2ñ¬n2òÒÓ/óan/ôbn/õcn/öÞâ/÷ßã/øàä/ùáå/úæë/ûçì/üèí/ýéî/þÍÎ/ÿÏÑ/ĀòÔ,ācn,Ăöï,ă¤ñ,Ąúð,ąêñ,ĆþÐ,ćÿÑ,Ĉac0ĉbc0Ċóõ0ċôā0Čßá0čà¤0Ďçé0ďèê0Đ÷ù0đøă0Ēûý0ēüą0ĔmÒ-ĕmĀ-ĖÞæ-ėČĎ-Ęčď-ęĂĄ-ĚĐĒ-ěđē-Ĝ²»-ĝÍÏ-ĞĆć-ğ²³-ĠĔĈ3ġĕĊ3ĢĖė3ģęĚ3ĤĢĝ(ĥĜğ(ĦģĞ(ħĠġ+Ĩĉċ+ĩĤĦ+ĪĘě+īħĨ1ĬĩĪ1ĭĬī*Įĥm*ĭĮ.")),vn}const gn=e=>function(e,t,n){let r=e,o=e.l;for(;;){if(r=r[t[o](n)?"1":"0"],"number"==typeof r||"string"==typeof r)return r;o=r.l}}(yn(),pn,e);function bn(e){const t=gn(e);return Kt[t]}function wn(e,t){var n=e.get(t);if(void 0===n)throw new Error("missing value from map "+t);return n}function _n(e,t,n,r){var o=e.get(t);return void 0===o?(o=n(),e.set(t,o)):r&&r(o),o}var xn=String.fromCharCode(65535),kn=Number.MIN_SAFE_INTEGER;function Sn(e,t){var n=t.selector,r=e.indexes?e.indexes.slice(0):[];t.index&&(r=[t.index]);var o=!!t.sort.find((e=>"desc"===Object.values(e)[0])),i=new Set;Object.keys(n).forEach((t=>{var r=K(e,t);r&&"boolean"===r.type&&Object.prototype.hasOwnProperty.call(n[t],"$eq")&&i.add(t)}));var s,a=t.sort.map((e=>Object.keys(e)[0])).filter((e=>!i.has(e))).join(","),c=-1;if(r.forEach((e=>{var r=!0,u=!0,l=e.map((e=>{var t=n[e],o=t?Object.keys(t):[],i={};return t&&o.length?o.forEach((e=>{if(In.has(e)){var n=function(e,t){switch(e){case"$eq":return{startKey:t,endKey:t,inclusiveEnd:!0,inclusiveStart:!0};case"$lte":return{endKey:t,inclusiveEnd:!0};case"$gte":return{startKey:t,inclusiveStart:!0};case"$lt":return{endKey:t,inclusiveEnd:!1};case"$gt":return{startKey:t,inclusiveStart:!1};default:throw new Error("SNH")}}(e,t[e]);i=Object.assign(i,n)}})):i={startKey:u?kn:xn,endKey:r?xn:kn,inclusiveStart:!0,inclusiveEnd:!0},void 0===i.startKey&&(i.startKey=kn),void 0===i.endKey&&(i.endKey=xn),void 0===i.inclusiveStart&&(i.inclusiveStart=!0),void 0===i.inclusiveEnd&&(i.inclusiveEnd=!0),u&&!i.inclusiveStart&&(u=!1),r&&!i.inclusiveEnd&&(r=!1),i})),h=l.map((e=>e.startKey)),d=l.map((e=>e.endKey)),f={index:e,startKeys:h,endKeys:d,inclusiveEnd:r,inclusiveStart:u,sortSatisfiedByIndex:!o&&a===e.filter((e=>!i.has(e))).join(","),selectorSatisfiedByIndex:Dn(e,t.selector,h,d)},m=function(e,t,n){var r=0,o=e=>{e>0&&(r+=e)},i=10,s=T(n.startKeys,(e=>e!==kn&&e!==xn));o(s*i);var a=T(n.startKeys,(e=>e!==xn&&e!==kn));o(a*i);var c=T(n.startKeys,((e,t)=>e===n.endKeys[t]));return o(c*i*1.5),o(n.sortSatisfiedByIndex?5:0),r}(0,0,f);(m>=c||t.index)&&(c=m,s=f)})),!s)throw p("SNH",{query:t});return s}var In=new Set(["$eq","$gt","$gte","$lt","$lte"]),En=new Set(["$eq","$gt","$gte"]),On=new Set(["$eq","$lt","$lte"]);function Dn(e,t,n,r){var o=Object.entries(t).find((([t,n])=>!e.includes(t)||Object.entries(n).find((([e,t])=>!In.has(e)))));if(o)return!1;if(t.$and||t.$or)return!1;var i=[],s=new Set;for(var[a,c]of Object.entries(t)){if(!e.includes(a))return!1;var u=Object.keys(c).filter((e=>En.has(e)));if(u.length>1)return!1;var l=u[0];if(l&&s.add(a),"$eq"!==l){if(i.length>0)return!1;i.push(l)}}var h=[],d=new Set;for(var[f,m]of Object.entries(t)){if(!e.includes(f))return!1;var p=Object.keys(m).filter((e=>On.has(e)));if(p.length>1)return!1;var v=p[0];if(v&&d.add(f),"$eq"!==v){if(h.length>0)return!1;h.push(v)}}var y=0;for(var g of e){for(var b of[s,d]){if(!b.has(g)&&b.size>0)return!1;b.delete(g)}if(n[y]!==r[y]&&s.size>0&&d.size>0)return!1;y++}return!0}class Pn extends Error{}const jn=Number.MAX_SAFE_INTEGER,Cn=Number.MIN_SAFE_INTEGER,Rn=Symbol("missing"),Mn=Object.freeze(new Error("mingo: cycle detected while processing object/array")),An=/^\[object ([a-zA-Z0-9]+)\]$/,Nn=e=>{const t=mr(e);let n=0,r=t.length;for(;r;)n=(n<<5)-n^t.charCodeAt(--r);return n>>>0},$n=new Set(["null","undefined","boolean","number","string","date","regexp"]),Bn={null:0,undefined:0,number:1,string:2,object:3,array:4,boolean:5,date:6,regexp:7,function:8},Tn=(e,t)=>{e===Rn&&(e=void 0),t===Rn&&(t=void 0);const[n,r]=[e,t].map((e=>Bn[Ln(e).toLowerCase()]));return n!==r?n-r:1===n||2===n||6===n?e<t?-1:e>t?1:0:dr(e,t)?0:e<t?-1:e>t?1:0};function qn(e,t){if(!e)throw new Pn(t)}const Ln=e=>An.exec(Object.prototype.toString.call(e))[1],Fn=e=>"boolean"==typeof e,Kn=e=>"string"==typeof e,zn=e=>!isNaN(e)&&"number"==typeof e,Qn=Array.isArray,Wn=e=>{if(!e)return!1;const t=Object.getPrototypeOf(e);return(t===Object.prototype||null===t)&&"[object Object]"===Object.prototype.toString.call(e)},Hn=e=>e===Object(e),Un=e=>e instanceof Date,Vn=e=>e instanceof RegExp,Jn=e=>"function"==typeof e,Gn=e=>null==e,Yn=(e,t)=>e.includes(t),Xn=(e,t)=>!Yn(e,t),Zn=e=>Gn(e)||Kn(e)&&!e||e instanceof Array&&0===e.length||Wn(e)&&0===Object.keys(e).length,er=e=>e===Rn,tr=e=>e instanceof Array?e:[e],nr=(e,t)=>!!e&&Object.prototype.hasOwnProperty.call(e,t),rr=e=>"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView(e),or=[Un,Vn,rr],ir=(e,t)=>{if(Gn(e))return e;if(t.has(e))throw Mn;const n=e.constructor;if(or.some((t=>t(e))))return new n(e);try{if(t.add(e),Qn(e))return e.map((e=>ir(e,t)));if(Wn(e)){const n={};for(const r in e)n[r]=ir(e[r],t);return n}}finally{t.delete(e)}return e},sr=e=>ir(e,new Set),ar=(e,t)=>Wn(e)&&Wn(t)||Qn(e)&&Qn(t);function cr(e,t,n){if(n=n||{flatten:!1},er(e)||Gn(e))return t;if(er(t)||Gn(t))return e;if(!ar(e,t)){if(n.skipValidation)return t||e;throw Error("mismatched types. must both be array or object")}if(n.skipValidation=!0,Qn(e)){const r=e,o=t;if(n.flatten){let e=0,i=0;for(;e<r.length&&i<o.length;)r[e]=cr(r[e++],o[i++],n);for(;i<o.length;)r.push(t[i++])}else gr(r,o)}else for(const r in t)e[r]=cr(e[r],t[r],n);return e}function ur(e,t=Nn){const n=new Map;return e.forEach(((r,o)=>{const i=pr(r,t);n.has(i)?n.get(i).some((t=>dr(e[t],r)))||n.get(i).push(o):n.set(i,[o])})),n}function lr(e,t=Nn){if(e.some((e=>0==e.length)))return[];if(1===e.length)return Array.from(e);const n=function(e,t,n=Tn){if(Zn(e))return e;const r=new Array,o=new Array;for(let n=0;n<e.length;n++){const i=e[n],s=t(i,n);Gn(s)?o.push(i):r.push([s,i])}return r.sort(((e,t)=>n(e[0],t[0]))),gr(o,r.map((e=>e[1])))}(e.map(((e,t)=>[t,e.length])),(e=>e[1])),r=e[n[0][0]],o=ur(r,t),i=new Map,s=new Array;return o.forEach(((t,o)=>{const a=t.map((e=>r[e])),c=a.map((e=>0)),u=a.map((e=>[n[0][0],0]));let l=!1;for(let t=1;t<e.length;t++){const[r,s]=n[t],h=e[r];if(i.has(t)||i.set(t,ur(h)),i.get(t).has(o)){const e=i.get(t).get(o).map((e=>h[e]));l=a.map(((n,s)=>e.some(((e,a)=>{const l=c[s];return dr(n,e)&&(c[s]++,r<u[s][0]&&(u[s]=[r,i.get(t).get(o)[a]])),l<c[s]})))).some(Boolean)}if(!l)return}l&&gr(s,c.map(((t,n)=>t===e.length-1?[a[n],u[n]]:Rn)).filter((e=>e!==Rn)))})),s.sort(((e,t)=>{const[n,[r,o]]=e,[i,[s,a]]=t,c=Tn(r,s);return 0!==c?c:Tn(o,a)})).map((e=>e[0]))}function hr(e,t=0){const n=new Array;return function e(t,r){for(let o=0,i=t.length;o<i;o++)Qn(t[o])&&(r>0||r<0)?e(t[o],Math.max(-1,r-1)):n.push(t[o])}(e,t),n}function dr(e,t){if(e===t||Object.is(e,t))return!0;const n=!!e&&e.constructor||e;if(null===e||null===t||void 0===e||void 0===t||n!==t.constructor||n===Function)return!1;if(n===Array||n===Object){const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;if(new Set([...n,...r]).size!=n.length)return!1;for(const r of n)if(!dr(e[r],t[r]))return!1;return!0}const r=Object.getPrototypeOf(e);return(rr(e)||r!==Object.prototype&&r!==Array.prototype&&Object.prototype.hasOwnProperty.call(r,"toString"))&&e.toString()===t.toString()}const fr=(e,t)=>{if(null===e)return"null";if(void 0===e)return"undefined";const n=e.constructor;switch(n){case RegExp:case Number:case Boolean:case Function:case Symbol:return e.toString();case String:return JSON.stringify(e);case Date:return e.toISOString()}if(rr(e))return n.name+"["+e.toString()+"]";if(t.has(e))throw Mn;try{if(t.add(e),Qn(e))return"["+e.map((e=>fr(e,t))).join(",")+"]";if(n===Object)return"{"+Object.keys(e).sort().map((n=>n+":"+fr(e[n],t))).join(",")+"}";const r=Object.getPrototypeOf(e);if(r!==Object.prototype&&r!==Array.prototype&&Object.prototype.hasOwnProperty.call(r,"toString"))return n.name+"("+JSON.stringify(e.toString())+")";const[o,i]=(e=>{let[t,n]=[Object.getPrototypeOf(e),Object.getOwnPropertyNames(e)],r=t;for(;!n.length&&t!==Object.prototype&&t!==Array.prototype;)r=t,n=Object.getOwnPropertyNames(t),t=Object.getPrototypeOf(t);const o={};return n.forEach((t=>o[t]=e[t])),[o,r]})(e);return n.name+fr(o,t)}finally{t.delete(e)}},mr=e=>fr(e,new Set);function pr(e,t){return t=t||Nn,Gn(e)?null:t(e).toString()}function vr(e,t,n=Nn){if(e.length<1)return new Map;const r=new Map,o=new Map;for(let i=0;i<e.length;i++){const s=e[i],a=t(s,i),c=pr(a,n);if(null===c)o.has(null)?o.get(null).push(s):o.set(null,[s]);else{const e=r.has(c)?r.get(c).find((e=>dr(e,a))):null;Gn(e)?(o.set(a,[s]),r.has(c)?r.get(c).push(a):r.set(c,[a])):o.get(e).push(s)}}return o}const yr=5e4;function gr(e,...t){return e instanceof Array?t.reduce(((e,t)=>{let n=Math.ceil(t.length/yr),r=0;for(;n-- >0;)Array.prototype.push.apply(e,t.slice(r,r+yr)),r+=yr;return e}),e):t.filter(Hn).reduce(((e,t)=>(Object.assign(e,t),e)),e)}function br(e,t){return Hn(e)?e[t]:void 0}function wr(e,t,n){let r=0;const o=$n.has(Ln(e).toLowerCase())?e:function e(t,n){let o=t;for(let t=0;t<n.length;t++){const i=n[t];if(null===/^\d+$/.exec(i)&&o instanceof Array){if(0===t&&r>0)break;r+=1;const i=n.slice(t);o=o.reduce(((t,n)=>{const r=e(n,i);return void 0!==r&&t.push(r),t}),[]);break}if(o=br(o,i),void 0===o)break}return o}(e,t.split("."));return o instanceof Array&&n?.unwrapArray?function(e,t){if(t<1)return e;for(;t--&&1===e.length;)e=e[0];return e}(o,r):o}function _r(e,t,n){const r=t.split("."),o=r[0],i=r.slice(1).join("."),s=null!==/^\d+$/.exec(o),a=r.length>1;let c,u;if(e instanceof Array)if(s)c=br(e,Number(o)),a&&(c=_r(c,i,n)),c=[c];else{c=[];for(const r of e)u=_r(r,t,n),n?.preserveMissing?(void 0===u&&(u=Rn),c.push(u)):void 0!==u&&c.push(u)}else{if(u=br(e,o),a&&(u=_r(u,i,n)),void 0===u)return;c=n?.preserveKeys?{...e}:{},c[o]=u}return c}function xr(e){if(e instanceof Array)for(let t=e.length-1;t>=0;t--)e[t]===Rn?e.splice(t,1):xr(e[t]);else if(Wn(e))for(const t in e)nr(e,t)&&xr(e[t])}const kr=/^\d+$/;function Sr(e,t,n,r){const o=t.split("."),i=o[0],s=o.slice(1).join(".");if(1===o.length)(Wn(e)||Qn(e)&&kr.test(i))&&n(e,i);else{r?.buildGraph&&Gn(e[i])&&(e[i]={});const t=e[i];if(!t)return;const a=!!(o.length>1&&kr.test(o[1]));t instanceof Array&&r?.descendArray&&!a?t.forEach((e=>Sr(e,s,n,r))):Sr(t,s,n,r)}}function Ir(e,t,n){Sr(e,t,((e,t)=>{e[t]=Jn(n)?n(e[t]):n}),{buildGraph:!0})}function Er(e,t,n){Sr(e,t,((e,t)=>{if(e instanceof Array){if(/^\d+$/.test(t))e.splice(parseInt(t),1);else if(n&&n.descendArray)for(const n of e)Wn(n)&&delete n[t]}else Wn(e)&&delete e[t]}),n)}const Or=/^\$[a-zA-Z0-9_]+$/;function Dr(e){return Or.test(e)}function Pr(e){if($n.has(Ln(e).toLowerCase()))return Vn(e)?{$regex:e}:{$eq:e};if(Hn(e)){const t=e;if(!Object.keys(t).some(Dr))return{$eq:e};if(nr(e,"$regex")){const t={...e};return t.$regex=new RegExp(e.$regex,e.$options),delete t.$options,t}}return e}var jr=(e=>(e.CLONE_ALL="CLONE_ALL",e.CLONE_INPUT="CLONE_INPUT",e.CLONE_OUTPUT="CLONE_OUTPUT",e.CLONE_OFF="CLONE_OFF",e))(jr||{});class Cr{constructor(e,t,n,r=Date.now()){this._opts=e,this._root=t,this._local=n,this.timestamp=r,this.update(t,n)}static init(e,t,n){return e instanceof Cr?new Cr(e._opts,Gn(e.root)?t:e.root,Object.assign({},e.local,n)):new Cr(e,t,n)}update(e,t){return this._root=e,this._local=t?Object.assign({},t,{variables:Object.assign({},this._local?.variables,t?.variables)}):t,this}getOptions(){return Object.freeze({...this._opts,context:Ar.from(this._opts.context)})}get root(){return this._root}get local(){return this._local}get idKey(){return this._opts.idKey}get collation(){return this._opts?.collation}get processingMode(){return this._opts?.processingMode||"CLONE_OFF"}get useStrictMode(){return this._opts?.useStrictMode}get scriptEnabled(){return this._opts?.scriptEnabled}get useGlobalContext(){return this._opts?.useGlobalContext}get hashFunction(){return this._opts?.hashFunction}get collectionResolver(){return this._opts?.collectionResolver}get jsonSchemaValidator(){return this._opts?.jsonSchemaValidator}get variables(){return this._opts?.variables}get context(){return this._opts?.context}}function Rr(e){return e instanceof Cr?e.getOptions():Object.freeze({idKey:"_id",scriptEnabled:!0,useStrictMode:!0,useGlobalContext:!0,processingMode:"CLONE_OFF",...e,context:e?.context?Ar.from(e?.context):Ar.init({})})}var Mr=(e=>(e.ACCUMULATOR="accumulator",e.EXPRESSION="expression",e.PIPELINE="pipeline",e.PROJECTION="projection",e.QUERY="query",e.WINDOW="window",e))(Mr||{});class Ar{constructor(e){this.operators={accumulator:{},expression:{},pipeline:{},projection:{},query:{},window:{}};for(const[t,n]of Object.entries(e))this.addOperators(t,n)}static init(e={}){return new Ar(e)}static from(e){return new Ar(e.operators)}addOperators(e,t){for(const[n,r]of Object.entries(t))this.getOperator(e,n)||(this.operators[e][n]=r);return this}addAccumulatorOps(e){return this.addOperators("accumulator",e)}addExpressionOps(e){return this.addOperators("expression",e)}addQueryOps(e){return this.addOperators("query",e)}addPipelineOps(e){return this.addOperators("pipeline",e)}addProjectionOps(e){return this.addOperators("projection",e)}addWindowOps(e){return this.addOperators("window",e)}getOperator(e,t){return e in this.operators&&this.operators[e][t]||null}}const Nr=Ar.init();function $r(e,t){for(const[n,r]of Object.entries(t)){qn(Jn(r)&&Dr(n),`'${n}' is not a valid operator`);const t=Br(e,n,null);qn(!t||r===t,`${n} already exists for '${e}' operators. Cannot change operator function once registered.`)}switch(e){case"accumulator":Nr.addAccumulatorOps(t);break;case"expression":Nr.addExpressionOps(t);break;case"pipeline":Nr.addPipelineOps(t);break;case"projection":Nr.addProjectionOps(t);break;case"query":Nr.addQueryOps(t);break;case"window":Nr.addWindowOps(t)}}function Br(e,t,n){const{context:r,useGlobalContext:o}=n||{},i=r?r.getOperator(e,t):null;return!i&&o?Nr.getOperator(e,t):i}const Tr={$$ROOT:(e,t,n)=>n.root,$$CURRENT:(e,t,n)=>e,$$REMOVE(e,t,n){},$$NOW:(e,t,n)=>new Date(n.timestamp)},qr={$$KEEP:(e,t,n)=>e,$$PRUNE(e,t,n){},$$DESCEND(e,t,n){if(!nr(t,"$cond"))return e;let r;for(const[o,i]of Object.entries(e))if(Hn(i)){if(i instanceof Array){const e=[];for(let r of i)Wn(r)&&(r=Fr(r,t,n.update(r))),Gn(r)||e.push(r);r=e}else r=Fr(i,t,n.update(i));Gn(r)?delete e[o]:e[o]=r}return e}};function Lr(e,t,n,r){const o=Cr.init(r,e);if(Dr(n=n||"")){const i=Br("expression",n,r);if(i)return i(e,t,o);const s=Br("accumulator",n,r);if(s)return e instanceof Array||(e=Lr(e,t,null,o),t=null),qn(e instanceof Array,`'${n}' target must be an array.`),s(e,t,o.update(null,o.local));throw new Pn(`operator '${n}' is not registered`)}if(Kn(t)&&t.length>0&&"$"===t[0]){if(nr(qr,t))return t;let n=o.root;const r=t.split(".");if(nr(Tr,r[0]))n=Tr[r[0]](e,null,o),t=t.slice(r[0].length+1);else if("$$"===r[0].slice(0,2)){n=Object.assign({},o.variables,{this:e},o.local?.variables);const i=r[0].slice(2);qn(nr(n,i),`Use of undefined variable: ${i}`),t=t.slice(2)}else t=t.slice(1);return""===t?n:wr(n,t)}if(Qn(t))return t.map((t=>Lr(e,t,null,o)));if(Wn(t)){const n={};for(const[i,s]of Object.entries(t))if(n[i]=Lr(e,s,i,o),["expression","accumulator"].some((e=>!!Br(e,i,r))))return qn(1===Object.keys(t).length,"Invalid aggregation expression '"+JSON.stringify(t)+"'"),n[i];return n}return t}function Fr(e,t,n){const r=Lr(e,t,null,n);return nr(qr,r)?qr[r](e,t,n):r}function Kr(e){return e instanceof Wr?e:new Wr(e)}function zr(e,t){const n=e.slice(t+1);e.splice(t),Array.prototype.push.apply(e,n)}const Qr=new Error;class Wr{constructor(e){let t;if(this.iteratees=[],this.yieldedValues=[],this.isDone=!1,e instanceof Function&&(e={next:e}),(n=e)&&"object"==typeof n&&n?.next instanceof Function){const n=e;t=()=>{const e=n.next();if(e.done)throw Qr;return e.value}}else if(e instanceof Array){const n=e,r=n.length;let o=0;t=()=>{if(o<r)return n[o++];throw Qr}}else if(!(e instanceof Function))throw new Pn("Lazy must be initialized with an array, generator, or function.");var n;this.getNext=function(e,t,n){let r=!1,o=-1,i=0;return function(s){try{e:for(;!r;){let a=e();o++;let c=-1;const u=t.length;let l=!1;for(;++c<u;){const e=t[c];switch(e.action){case 0:a=e.func(a,o);break;case 1:if(!e.func(a,o))continue e;break;case 2:--e.count,e.count||(l=!0);break;case 3:--e.count,e.count||zr(t,c);continue e;default:break e}}if(r=l,!s)return{value:a,done:!1};n[i++]=a}}catch(e){if(e!==Qr)throw e}return r=!0,{done:r}}}(t,this.iteratees,this.yieldedValues)}push(e,t){return"function"==typeof t?this.iteratees.push({action:e,func:t}):"number"==typeof t&&this.iteratees.push({action:e,count:t}),this}next(){return this.getNext()}map(e){return this.push(0,e)}filter(e){return this.push(1,e)}take(e){return e>0?this.push(2,e):this}drop(e){return e>0?this.push(3,e):this}transform(e){const t=this;let n;return Kr((()=>(n||(n=Kr(e(t.value()))),n.next())))}value(){return this.isDone||(this.isDone=this.getNext(!0).done),this.yieldedValues}each(e){for(;;){const t=this.next();if(t.done)break;if(!1===e(t.value))return!1}return!0}reduce(e,t){let n=this.next();for(void 0!==t||n.done||(t=n.value,n=this.next());!n.done;)t=e(t,n.value),n=this.next();return t}size(){return this.reduce(((e,t)=>++e),0)}[Symbol.iterator](){return this}}class Hr{constructor(e,t){this.pipeline=e,this.options=Rr(t)}stream(e){let t=Kr(e);const n=this.options.processingMode;n!=jr.CLONE_ALL&&n!=jr.CLONE_INPUT||t.map(sr);const r=new Array;if(!Zn(this.pipeline))for(const e of this.pipeline){const n=Object.keys(e),o=n[0],i=Br(Mr.PIPELINE,o,this.options);qn(1===n.length&&!!i,`invalid pipeline operator ${o}`),r.push(o),t=i(t,e[o],this.options)}return(n==jr.CLONE_OUTPUT||n==jr.CLONE_ALL&&lr([["$group","$unwind"],r]).length)&&t.map(sr),t}run(e){return this.stream(e).value()}}class Ur{constructor(e,t,n,r){this.source=e,this.predicate=t,this.projection=n,this.options=r,this.operators=[],this.result=null,this.buffer=[]}fetch(){return this.result||(Wn(this.projection)&&this.operators.push({$project:this.projection}),this.result=Kr(this.source).filter(this.predicate),this.operators.length>0&&(this.result=new Hr(this.operators,this.options).stream(this.result))),this.result}fetchAll(){const e=Kr([...this.buffer]);return this.buffer=[],function(...e){let t=0;return Kr((()=>{for(;t<e.length;){const n=e[t].next();if(!n.done)return n;t++}return{done:!0}}))}(e,this.fetch())}all(){return this.fetchAll().value()}count(){return this.all().length}skip(e){return this.operators.push({$skip:e}),this}limit(e){return this.operators.push({$limit:e}),this}sort(e){return this.operators.push({$sort:e}),this}collation(e){return this.options={...this.options,collation:e},this}next(){if(this.buffer.length>0)return this.buffer.pop();const e=this.fetch().next();return e.done?void 0:e.value}hasNext(){if(this.buffer.length>0)return!0;const e=this.fetch().next();return!e.done&&(this.buffer.push(e.value),!0)}map(e){return this.all().map(e)}forEach(e){this.all().forEach(e)}[Symbol.iterator](){return this.fetchAll()}}class Vr{constructor(e,t){this.condition=e,this.options=Rr(t),this.compiled=[],this.compile()}compile(){qn(Wn(this.condition),`query criteria must be an object: ${JSON.stringify(this.condition)}`);const e={};for(const[t,n]of Object.entries(this.condition)){if("$where"===t)Object.assign(e,{field:t,expr:n});else if(Yn(["$and","$or","$nor","$expr","$jsonSchema"],t))this.processOperator(t,t,n);else{qn(!Dr(t),`unknown top level operator: ${t}`);for(const[e,r]of Object.entries(Pr(n)))this.processOperator(t,e,r)}e.field&&this.processOperator(e.field,e.field,e.expr)}}processOperator(e,t,n){const r=Br(Mr.QUERY,t,this.options);if(!r)throw new Pn(`unknown query operator ${t}`);const o=r(e,n,this.options);this.compiled.push(o)}test(e){for(let t=0,n=this.compiled.length;t<n;t++)if(!this.compiled[t](e))return!1;return!0}find(e,t){return new Ur(e,(e=>this.test(e)),t||{},this.options)}remove(e){return e.reduce(((e,t)=>(this.test(t)||e.push(t),e)),[])}}const Jr=(e,t,n)=>{if(Zn(t)||!Wn(t))return e;let r=Tn;const o=n.collation;return Wn(o)&&Kn(o.locale)&&(r=function(e){const t={sensitivity:Gr[e.strength||3],caseFirst:"off"===e.caseFirst?"false":e.caseFirst||"false",numeric:e.numericOrdering||!1,ignorePunctuation:"shifted"===e.alternate};!0===(e.caseLevel||!1)&&("base"===t.sensitivity&&(t.sensitivity="case"),"accent"===t.sensitivity&&(t.sensitivity="variant"));const n=new Intl.Collator(e.locale,t);return(e,t)=>{if(!Kn(e)||!Kn(t))return Tn(e,t);const r=n.compare(e,t);return r<0?-1:r>0?1:0}}(o)),e.transform((e=>{const o=Object.keys(t);for(const i of o.reverse()){const o=vr(e,(e=>wr(e,i)),n.hashFunction),s=Array.from(o.keys()).sort(r);-1===t[i]&&s.reverse(),e=[],s.reduce(((e,t)=>gr(e,o.get(t))),e)}return e}))},Gr={1:"base",2:"accent",3:"variant"};function Yr(e){const t=(t,n,r)=>{const o={unwrapArray:!0},i=Math.max(1,t.split(".").length-1);return s=>{const a=wr(s,t,o);return e(a,n,{...r,depth:i})}};return t.op="query",t}function Xr(e){return(t,n,r)=>{const o=Lr(t,n,null,r);return e(...o)}}function Zr(e,t,n){if(dr(e,t))return!0;if(Gn(e)&&Gn(t))return!0;if(e instanceof Array){const r=dr.bind(null,t);return e.some(r)||hr(e,n?.depth).some(r)}return!1}function eo(e,t,n){return!Zr(e,t,n)}function to(e,t,n){return Gn(e)?t.some((e=>null===e)):lr([tr(e),t],n?.hashFunction).length>0}function no(e,t,n){return!to(e,t,n)}function ro(e,t,n){return po(e,t,((e,t)=>Tn(e,t)<0))}function oo(e,t,n){return po(e,t,((e,t)=>Tn(e,t)<=0))}function io(e,t,n){return po(e,t,((e,t)=>Tn(e,t)>0))}function so(e,t,n){return po(e,t,((e,t)=>Tn(e,t)>=0))}function ao(e){return Dr(e)&&-1===["$and","$or","$nor"].indexOf(e)}function co(e,t,n){if(Qn(e)&&!Zn(e)){let r=e=>e,o=t;Object.keys(t).every(ao)&&(o={temp:t},r=e=>({temp:e}));const i=new Vr(o,n);for(let t=0,n=e.length;t<n;t++)if(i.test(r(e[t])))return!0}return!1}const uo=e=>null===e,lo=e=>zn(e)&&e>=-2147483648&&e<=2147483647&&-1===e.toString().indexOf("."),ho=e=>zn(e)&&e>=Cn&&e<=jn&&-1===e.toString().indexOf("."),fo={array:Qn,bool:Fn,boolean:Fn,date:Un,decimal:zn,double:zn,int:lo,long:ho,number:zn,null:uo,object:Wn,regex:Vn,regexp:Vn,string:Kn,undefined:Gn,function:e=>{throw new Pn("unsupported type key `function`.")},1:zn,2:Kn,3:Wn,4:Qn,6:Gn,8:Fn,9:Un,10:uo,11:Vn,16:lo,18:ho,19:zn};function mo(e,t,n){const r=fo[t];return!!r&&r(e)}function po(e,t,n){return tr(e).some((e=>Ln(e)===Ln(t)&&n(e,t)))}Xr(no);const vo=(e,t)=>(n,r,o)=>{qn(Qn(r),`${e}: expression must be an array.`);const i=Lr(n,r,null,o);return i.some(Gn)?null:(qn(i.every(zn),`${e}: expression must evalue to array of numbers.`),t(i))};vo("$bitAnd",(e=>e.reduce(((e,t)=>e&t),-1))),vo("$bitOr",(e=>e.reduce(((e,t)=>e|t),0))),vo("$bitXor",(e=>e.reduce(((e,t)=>e^t),0))),Xr(Zr),Xr(io),Xr(so),Xr(ro),Xr(oo),Xr(eo);const yo=(e,t)=>{const n={};return e.split("").forEach(((e,r)=>n[e]=t*(r+1))),n};yo("ABCDEFGHIKLM",1),yo("NOPQRSTUVWXY",-1);const go={undefined:null,null:null,NaN:NaN,Infinity:new Error,"-Infinity":new Error};function bo(e,t=go){const n=Object.assign({},go,t),r=new Set(Object.keys(n));return(t,o,i)=>{const s=Lr(t,o,null,i);if(r.has(`${s}`)){const t=n[`${s}`];if(t instanceof Error)throw new Pn(`cannot apply $${e.name} to -inf, value must in (-inf,inf)`);return t}return e(s)}}bo(Math.acos,{Infinity:1/0,0:new Error}),bo(Math.acosh,{Infinity:1/0,0:new Error}),bo(Math.asin),bo(Math.asinh,{Infinity:1/0,"-Infinity":-1/0}),bo(Math.atan),bo(Math.atanh,{1:1/0,"-1":-1/0}),bo(Math.cos),bo(Math.cosh,{"-Infinity":1/0,Infinity:1/0});const wo=Math.PI/180,_o=(bo((e=>e*wo),{Infinity:1/0,"-Infinity":1/0}),180/Math.PI);bo((e=>e*_o),{Infinity:1/0,"-Infinity":-1/0}),bo(Math.sin),bo(Math.sinh,{"-Infinity":-1/0,Infinity:1/0}),bo(Math.tan);const xo=(e,t,n)=>{if(Zn(t))return e;let r=Object.keys(t),o=!1;So(t,n);const i=n.idKey;if(Yn(r,i)){const e=t[i];0!==e&&!1!==e||(r=r.filter(Xn.bind(null,[i])),o=0==r.length)}else r.push(i);const s=Cr.init(n);return e.map((e=>ko(e,t,s.update(e),r,o)))};function ko(e,t,n,r,o){let i={},s=!1,a=!1;const c=[];o&&c.push(n.idKey);for(const o of r){let r;const u=t[o];if(o!==n.idKey&&Yn([0,!1],u)&&(a=!0),o===n.idKey&&Zn(u))r=e[o];else if(Kn(u))r=Lr(e,u,o,n);else if(Yn([1,!0],u));else if(u instanceof Array)r=u.map((t=>{const r=Lr(e,t,null,n);return Gn(r)?null:r}));else{if(!Wn(u)){c.push(o);continue}{const t=u,i=Object.keys(u),a=1==i.length?i[0]:"",c=Br(Mr.PROJECTION,a,n);if(c)"$slice"===a?tr(t[a]).every(zn)?(r=c(e,t[a],o,n),s=!0):r=Lr(e,t,o,n):r=c(e,t[a],o,n);else if(Dr(a))r=Lr(e,t[a],a,n);else if(nr(e,o)){So(t,n);let s=e[o];s instanceof Array?r=s.map((e=>ko(e,t,n,i,!1))):(s=Wn(s)?s:e,r=ko(s,t,n,i,!1))}else r=Lr(e,u,null,n)}}const l=_r(e,o,{preserveMissing:!0});void 0!==l&&cr(i,l,{flatten:!0}),Xn([0,1,!1,!0],u)&&(void 0===r?Er(i,o,{descendArray:!0}):Ir(i,o,r))}if(xr(i),(s||a||o)&&(i=gr({},e,i),c.length>0))for(const e of c)Er(i,e,{descendArray:!0});return i}function So(e,t){const n=[!1,!1];for(const[r,o]of Object.entries(e)){if(r===t?.idKey)return;0===o||!1===o?n[0]=!0:1!==o&&!0!==o||(n[1]=!0),qn(!(n[0]&&n[1]),"Projection cannot have a mix of inclusion and exclusion.")}}const Io=(e,t,n)=>{qn(Qn(t),"Invalid expression: $and expects value to be an Array.");const r=t.map((e=>new Vr(e,n)));return e=>r.every((t=>t.test(e)))},Eo=(e,t,n)=>{qn(Qn(t),"Invalid expression. $or expects value to be an Array");const r=t.map((e=>new Vr(e,n)));return e=>r.some((t=>t.test(e)))},Oo=(e,t,n)=>{qn(Qn(t),"Invalid expression. $nor expects value to be an array.");const r=Eo("$or",t,n);return e=>!r(e)},Do=(e,t,n)=>{const r={};r[e]=Pr(t);const o=new Vr(r,n);return e=>!o.test(e)},Po=Yr(Zr),jo=Yr(io),Co=Yr(so),Ro=Yr(to),Mo=Yr(ro),Ao=Yr(oo),No=Yr(eo),$o=Yr(no),Bo=Yr((function(e,t,n){return tr(e).some((e=>2===t.length&&e%t[0]===t[1]))})),To=Yr((function(e,t,n){const r=tr(e),o=e=>Kn(e)&&((e,t=!0)=>!!e||t&&""===e)(t.exec(e),n?.useStrictMode);return r.some(o)||hr(r,1).some(o)}));Yr((function(e,t,n){if(!(Qn(e)&&Qn(t)&&e.length&&t.length))return!1;let r=!0;for(const o of t){if(!r)break;r=Wn(o)&&Yn(Object.keys(o),"$elemMatch")?co(e,o.$elemMatch,n):o instanceof RegExp?e.some((e=>"string"==typeof e&&o.test(e))):e.some((e=>dr(o,e)))}return r}));const qo=Yr(co),Lo=Yr((function(e,t,n){return Array.isArray(e)&&e.length===t})),Fo=Yr((function(e,t,n){return(!1===t||0===t)&&void 0===e||(!0===t||1===t)&&void 0!==e})),Ko=Yr((function(e,t,n){return Array.isArray(t)?t.findIndex((t=>mo(e,t)))>=0:mo(e,t)}));var zo=!1;function Qo(e,t){var n=z(e.primaryKey);t=C(t);var r,o=M(t);if("number"!=typeof o.skip&&(o.skip=0),o.selector?(o.selector=o.selector,Object.entries(o.selector).forEach((([e,t])=>{"object"==typeof t&&null!==t||(o.selector[e]={$eq:t})}))):o.selector={},o.index){var i=(r=o.index,Array.isArray(r)?r.slice(0):[r]);i.includes(n)||i.push(n),o.index=i}if(o.sort){var s=o.sort.find((e=>{return t=e,Object.keys(t)[0]===n;var t}));s||(o.sort=o.sort.slice(0),o.sort.push({[n]:"asc"}))}else if(o.index)o.sort=o.index.map((e=>({[e]:"asc"})));else{if(e.indexes){var a=new Set;Object.entries(o.selector).forEach((([e,t])=>{("object"!=typeof t||null===t||Object.keys(t).find((e=>In.has(e))))&&a.add(e)}));var c,u=-1;e.indexes.forEach((e=>{var t=$(e)?e:[e],n=t.findIndex((e=>!a.has(e)));n>0&&n>u&&(u=n,c=t)})),c&&(o.sort=c.map((e=>({[e]:"asc"}))))}o.sort||(o.sort=[{[n]:"asc"}])}return o}function Wo(e,t){if(!t.sort)throw p("SNH",{query:t});var n=[];return t.sort.forEach((e=>{var t=Object.keys(e)[0],r=Object.values(e)[0];n.push({key:t,direction:r,getValueFn:j(t)})})),(e,t)=>{for(var r=0;r<n.length;++r){var o=n[r],i=o.getValueFn(e),s=o.getValueFn(t);if(i!==s)return"asc"===o.direction?Tn(i,s):Tn(s,i)}}}function Ho(e,t){if(!t.sort)throw p("SNH",{query:t});var n,r=(n=t.selector,zo||($r(Mr.PIPELINE,{$sort:Jr,$project:xo}),$r(Mr.QUERY,{$and:Io,$eq:Po,$elemMatch:qo,$exists:Fo,$gt:jo,$gte:Co,$in:Ro,$lt:Mo,$lte:Ao,$ne:No,$nin:$o,$mod:Bo,$nor:Oo,$not:Do,$or:Eo,$regex:To,$size:Lo,$type:Ko}),zo=!0),new Vr(n));return e=>r.test(e)}async function Uo(e,t){var n=await e.exec();return n?Array.isArray(n)?Promise.all(n.map((e=>t(e)))):await t(n):null}function Vo(e,t){return t.sort&&0!==t.sort.length?t.sort.map((e=>Object.keys(e)[0])):[e]}var Jo=new WeakMap;function Go(t,n){if(!t.collection.database.eventReduce)return{runFullQueryAgain:!0};var r=function(e){return _n(Jo,e,(()=>{var t=e.collection,n=Qo(t.storageInstance.schema,M(e.mangoQuery)),r=t.schema.primaryPath,o=Wo(t.schema.jsonSchema,n),i=Ho(t.schema.jsonSchema,n);return{primaryKey:e.collection.schema.primaryPath,skip:n.skip,limit:n.limit,sortFields:Vo(r,n),sortComparator:(t,n)=>{var r={docA:t,docB:n,rxQuery:e};return o(r.docA,r.docB)},queryMatcher:t=>i({doc:t,rxQuery:e}.doc)}}))}(t),o=G(t._result).docsData.slice(0),i=G(t._result).docsDataMap,s=!1,a=n.map((t=>function(t){switch(t.operation){case"INSERT":return{operation:t.operation,id:t.documentId,doc:t.documentData,previous:null};case"UPDATE":return{operation:t.operation,id:t.documentId,doc:e.deepFreezeWhenDevMode(t.documentData),previous:t.previousDocumentData?t.previousDocumentData:"UNKNOWN"};case"DELETE":return{operation:t.operation,id:t.documentId,doc:null,previous:t.previousDocumentData}}}(t))).filter(B).find((e=>{var t=bn({queryParams:r,changeEvent:e,previousResults:o,keyDocumentMap:i});return"runFullQueryAgain"===t||("doNothing"!==t?(s=!0,function(e,t,n,r,o){(0,zt[e])({queryParams:t,changeEvent:n,previousResults:r,keyDocumentMap:o})}(t,r,e,o,i),!1):void 0)}));return a?{runFullQueryAgain:!0}:{runFullQueryAgain:!1,changed:s,newResults:o}}var Yo=function(){function e(){this._map=new Map}return e.prototype.getByQuery=function(e){var t=e.toString();return _n(this._map,t,(()=>e))},e}();function Xo(e,t){t.uncached=!0;var n=t.toString();e._map.delete(n)}function Zo(e){return e.refCount$.observers.length}var ei,ti,ni=(ei=100,ti=3e4,(e,t)=>{if(!(t._map.size<ei)){var n=J()-ti,r=[],o=Array.from(t._map.values());for(var i of o)Zo(i)>0||(0===i._lastEnsureEqual&&i._creationTime<n?Xo(t,i):r.push(i));var s=r.length-ei;s<=0||r.sort(((e,t)=>e._lastEnsureEqual-t._lastEnsureEqual)).slice(0,s).forEach((e=>Xo(t,e)))}}),ri=new WeakSet;function oi(e){ri.has(e)||(ri.add(e),new Promise((e=>setTimeout(e,0))).then((()=>{return e=200,Ct=Ct.then((()=>jt(e)));var e})).then((()=>{e.destroyed||e.cacheReplacementPolicy(e,e._queryCache),ri.delete(e)})))}var ii=function(){function e(e,t,n){this.cacheItemByDocId=new Map,this.tasks=new Set,this.registry="function"==typeof FinalizationRegistry?new FinalizationRegistry((e=>{var t=e.docId,n=this.cacheItemByDocId.get(t);n&&(n[0].delete(e.revisionHeight),0===n[0].size&&this.cacheItemByDocId.delete(t))})):void 0,this.primaryPath=e,this.changes$=t,this.documentCreator=n,t.subscribe((e=>{this.tasks.add((()=>{for(var t=this.cacheItemByDocId,n=0;n<e.length;n++){var r=e[n],o=t.get(r.documentId);if(o){var i=r.documentData;i||(i=r.previousDocumentData),o[1]=i}}})),this.tasks.size<=1&&jt().then((()=>{this.processTasks()}))}))}var t=e.prototype;return t.processTasks=function(){0!==this.tasks.size&&(Array.from(this.tasks).forEach((e=>e())),this.tasks.clear())},t.getLatestDocumentData=function(e){return this.processTasks(),wn(this.cacheItemByDocId,e)[1]},t.getLatestDocumentDataIfExists=function(e){this.processTasks();var t=this.cacheItemByDocId.get(e);if(t)return t[1]},o(e,[{key:"getCachedRxDocuments",get:function(){return A(this,"getCachedRxDocuments",si(this))}},{key:"getCachedRxDocument",get:function(){var e=si(this);return A(this,"getCachedRxDocument",(t=>e([t])[0]))}}])}();function si(t){var n=t.primaryPath,r=t.cacheItemByDocId,o=t.registry,i=e.deepFreezeWhenDevMode,s=t.documentCreator;return e=>{for(var a=new Array(e.length),c=[],u=0;u<e.length;u++){var l=e[u],h=l[n],d=X(l._rev),f=void 0,m=void 0,p=r.get(h);p?m=(f=p[0]).get(d):(p=[f=new Map,l],r.set(h,p));var v=m?m.deref():void 0;v||(l=i(l),v=s(l),f.set(d,ci(v)),o&&c.push(v)),a[u]=v}return c.length>0&&o&&(t.tasks.add((()=>{for(var e=0;e<c.length;e++){var t=c[e];o.register(t,{docId:t.primary,revisionHeight:X(t.revision)})}})),t.tasks.size<=1&&jt().then((()=>{t.processTasks()}))),a}}function ai(e,t){return(0,e.getCachedRxDocuments)(t)}var ci="function"==typeof WeakRef?function(e){return new WeakRef(e)}:function(e){return{deref:()=>e}},ui=o((function(e,t,n){this.time=J(),this.collection=e,this.count=n,this.documents=ai(this.collection._docCache,t)}),[{key:"docsData",get:function(){return A(this,"docsData",this.documents.map((e=>e._data)))}},{key:"docsDataMap",get:function(){var e=new Map;return this.documents.forEach((t=>{e.set(t.primary,t._data)})),A(this,"docsDataMap",e)}},{key:"docsMap",get:function(){for(var e=new Map,t=this.documents,n=0;n<t.length;n++){var r=t[n];e.set(r.primary,r)}return A(this,"docsMap",e)}}]),li=0,hi=function(){function e(e,t,n,r={}){this.id=++li,this._execOverDatabaseCount=0,this._creationTime=J(),this._lastEnsureEqual=0,this.uncached=!1,this.refCount$=new Ke(null),this._result=null,this._latestChangeEvent=-1,this._lastExecStart=0,this._lastExecEnd=0,this._ensureEqualQueue=Ot,this.op=e,this.mangoQuery=t,this.collection=n,this.other=r,t||(this.mangoQuery={selector:{}}),this.isFindOneByIdQuery=function(e,t){if(!t.skip&&t.selector&&1===Object.keys(t.selector).length&&t.selector[e]){var n=t.selector[e];if("string"==typeof n)return n;if(1===Object.keys(n).length&&"string"==typeof n.$eq)return n.$eq;if(1===Object.keys(n).length&&Array.isArray(n.$eq)&&!n.$eq.find((e=>"string"!=typeof e)))return n.$eq}return!1}(this.collection.schema.primaryPath,t)}var t=e.prototype;return t._setResultData=function(e){if("number"!=typeof e){e instanceof Map&&(e=Array.from(e.values()));var t=new ui(this.collection,e,e.length);this._result=t}else this._result=new ui(this.collection,[],e)},t._execOverDatabase=async function(){if(this._execOverDatabaseCount=this._execOverDatabaseCount+1,this._lastExecStart=J(),"count"===this.op){var e=this.getPreparedQuery(),t=await this.collection.storageInstance.count(e);if("slow"!==t.mode||this.collection.database.allowSlowCount)return t.count;throw p("QU14",{collection:this.collection,queryObj:this.mangoQuery})}if("findByIds"===this.op){var n=G(this.mangoQuery.selector)[this.collection.schema.primaryPath].$in,r=new Map,o=[];return n.forEach((e=>{var t=this.collection._docCache.getLatestDocumentDataIfExists(e);if(t){if(!t._deleted){var n=this.collection._docCache.getCachedRxDocument(t);r.set(e,n)}}else o.push(e)})),o.length>0&&(await this.collection.storageInstance.findDocumentsById(o,!1)).forEach((e=>{var t=this.collection._docCache.getCachedRxDocument(e);r.set(t.primary,t)})),r}var i=async function(e){var t=[],n=e.collection;if(e.isFindOneByIdQuery)if(Array.isArray(e.isFindOneByIdQuery)){var r=e.isFindOneByIdQuery;if(r=r.filter((n=>{var r=e.collection._docCache.getLatestDocumentDataIfExists(n);return!r||(r._deleted||t.push(r),!1)})),r.length>0){var o=await n.storageInstance.findDocumentsById(r,!1);q(t,o)}}else{var i=e.isFindOneByIdQuery,s=e.collection._docCache.getLatestDocumentDataIfExists(i);if(!s){var a=await n.storageInstance.findDocumentsById([i],!1);a[0]&&(s=a[0])}s&&!s._deleted&&t.push(s)}else{var c=e.getPreparedQuery(),u=await n.storageInstance.query(c);t=u.documents}return t}(this);return i.then((e=>(this._lastExecEnd=J(),e)))},t.exec=function(e){if(e&&"findOne"!==this.op)throw p("QU9",{collection:this.collection.name,query:this.mangoQuery,op:this.op});return mi(this).then((()=>function(e,t){var n="object"==typeof t;return new Promise((function(r,o){var i=new je({next:function(e){r(e),i.unsubscribe()},error:o,complete:function(){n?r(t.defaultValue):o(new ze)}});e.subscribe(i)}))}(this.$))).then((t=>{if(!t&&e)throw p("QU10",{collection:this.collection.name,query:this.mangoQuery,op:this.op});return t}))},t.toString=function(){var e=R({op:this.op,query:this.mangoQuery,other:this.other},!0),t=JSON.stringify(e);return this.toString=()=>t,t},t.getPreparedQuery=function(){var e={rxQuery:this,mangoQuery:Qo(this.collection.schema.jsonSchema,this.mangoQuery)};e.mangoQuery.selector._deleted={$eq:!1},e.mangoQuery.index&&e.mangoQuery.index.unshift("_deleted"),At("prePrepareQuery",e);var t=pi(this.collection.schema.jsonSchema,e.mangoQuery);return this.getPreparedQuery=()=>t,t},t.doesDocumentDataMatch=function(e){return!e._deleted&&this.queryMatcher(e)},t.remove=function(){return this.exec().then((e=>Array.isArray(e)?Promise.all(e.map((e=>e.remove()))):e.remove()))},t.incrementalRemove=function(){return Uo(this.asRxQuery,(e=>e.incrementalRemove()))},t.update=function(e){throw Rt("update")},t.patch=function(e){return Uo(this.asRxQuery,(t=>t.patch(e)))},t.incrementalPatch=function(e){return Uo(this.asRxQuery,(t=>t.incrementalPatch(e)))},t.modify=function(e){return Uo(this.asRxQuery,(t=>t.modify(e)))},t.incrementalModify=function(e){return Uo(this.asRxQuery,(t=>t.incrementalModify(e)))},t.where=function(e){throw Rt("query-builder")},t.sort=function(e){throw Rt("query-builder")},t.skip=function(e){throw Rt("query-builder")},t.limit=function(e){throw Rt("query-builder")},o(e,[{key:"$",get:function(){if(!this._$){var e=this.collection.$.pipe(yt((e=>!e.isLocal)),bt(null),st((()=>mi(this))),Ue((()=>this._result)),kt(Y),St(((e,t)=>!(!e||e.time!==G(t).time))),yt((e=>!!e)),Ue((e=>{var t=G(e);return"count"===this.op?t.count:"findOne"===this.op?0===t.documents.length?null:t.documents[0]:"findByIds"===this.op?t.docsMap:t.documents.slice(0)})));this._$=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=lt(e),r=ht(e,1/0),o=e;return o.length?1===o.length?rt(o[0]):at(r)(vt(o,n)):ct}(e,this.refCount$.pipe(yt((()=>!1))))}return this._$}},{key:"$$",get:function(){return this.collection.database.getReactivityFactory().fromObservable(this.$,void 0,this.collection.database)}},{key:"queryMatcher",get:function(){return this.collection.schema.jsonSchema,A(this,"queryMatcher",Ho(0,Qo(this.collection.schema.jsonSchema,this.mangoQuery)))}},{key:"asRxQuery",get:function(){return this}}])}();function di(e,t,n,r){At("preCreateRxQuery",{op:e,queryObj:t,collection:n,other:r});var o,i=new hi(e,t,n,r);return i=(o=i).collection._queryCache.getByQuery(o),oi(n),i}function fi(e){var t=e.asRxQuery.collection._changeEventBuffer.getCounter();return e._latestChangeEvent>=t}function mi(e){return e.collection.database.destroyed||fi(e)?Ot:(e._ensureEqualQueue=e._ensureEqualQueue.then((()=>function(e){if(e._lastEnsureEqual=J(),e.collection.database.destroyed||fi(e))return Ot;var t=!1,n=!1;if(-1===e._latestChangeEvent&&(n=!0),!n){var r=e.asRxQuery.collection._changeEventBuffer.getFrom(e._latestChangeEvent+1);if(null===r)n=!0;else{e._latestChangeEvent=e.asRxQuery.collection._changeEventBuffer.getCounter();var o=e.asRxQuery.collection._changeEventBuffer.reduceByLastOfDoc(r);if("count"===e.op){var i=G(e._result).count,s=i;o.forEach((t=>{var n=t.previousDocumentData&&e.doesDocumentDataMatch(t.previousDocumentData),r=e.doesDocumentDataMatch(t.documentData);!n&&r&&s++,n&&!r&&s--})),s!==i&&(t=!0,e._setResultData(s))}else{var a=Go(e,o);a.runFullQueryAgain?n=!0:a.changed&&(t=!0,e._setResultData(a.newResults))}}}return n?e._execOverDatabase().then((n=>(e._latestChangeEvent=e.collection._changeEventBuffer.getCounter(),"number"==typeof n?(e._result&&n===e._result.count||(t=!0,e._setResultData(n)),t):(e._result&&function(e,t,n){if(t.length!==n.length)return!1;for(var r=0,o=t.length;r<o;){var i=t[r],s=n[r];if(r++,i._rev!==s._rev||i[e]!==s[e])return!1}return!0}(e.collection.schema.primaryPath,n,e._result.docsData)||(t=!0,e._setResultData(n)),t)))):Promise.resolve(t)}(e))),e._ensureEqualQueue)}function pi(e,t){if(!t.sort)throw p("SNH",{query:t});return{query:t,queryPlan:Sn(e,t)}}var vi="_rxdb_internal";async function yi(e,t){return(await e.findDocumentsById([t],!1))[0]||void 0}function gi(e,t,n,r){if(r)throw 409===r.status?p("CONFLICT",{collection:e.name,id:t,writeError:r,data:n}):422===r.status?p("VD2",{collection:e.name,id:t,writeError:r,data:n}):r}function bi(e){return{previous:e.previous,document:wi(e.document)}}function wi(e){if(!e._attachments||0===Object.keys(e._attachments).length)return e;var t=C(e);return t._attachments={},Object.entries(e._attachments).forEach((([e,n])=>{var r,o,i;t._attachments[e]=(i=(r=n).data)?{length:(o=i,atob(o).length),digest:r.digest,type:r.type}:r})),t}function _i(e){return Object.assign({},e,{_meta:C(e._meta)})}var xi=new WeakMap;function ki(t,n,r){e.deepFreezeWhenDevMode(r);var o=z(n.schema.primaryKey),i={originalStorageInstance:n,schema:n.schema,internals:n.internals,collectionName:n.collectionName,databaseName:n.databaseName,options:n.options,bulkWrite(e,r){for(var i=t.token,s=new Array(e.length),a=J(),c=0;c<e.length;c++){var u=e[c],l=_i(u.document);l._meta.lwt=a;var h=u.previous;l._rev=Z(i,h),s[c]={document:l,previous:h}}return At("preStorageWrite",{storageInstance:this.originalStorageInstance,rows:s}),t.lockedRun((()=>n.bulkWrite(s,r))).then((e=>{var i={error:[]},a=Ii(o,s,e);xi.set(i,a);var c=0===e.error.length?[]:e.error.filter((e=>!(409!==e.status||e.writeRow.previous||e.writeRow.document._deleted||!G(e.documentInDb)._deleted)||(i.error.push(e),!1)));if(c.length>0){var u=c.map((e=>({previous:e.documentInDb,document:Object.assign({},e.writeRow.document,{_rev:Z(t.token,e.documentInDb)})})));return t.lockedRun((()=>n.bulkWrite(u,r))).then((e=>{q(i.error,e.error);var t=Ii(o,u,e);return q(a,t),i}))}return i}))},query:e=>t.lockedRun((()=>n.query(e))),count:e=>t.lockedRun((()=>n.count(e))),findDocumentsById:(e,r)=>t.lockedRun((()=>n.findDocumentsById(e,r))),getAttachmentData:(e,r,o)=>t.lockedRun((()=>n.getAttachmentData(e,r,o))),getChangedDocumentsSince:n.getChangedDocumentsSince?(e,r)=>t.lockedRun((()=>n.getChangedDocumentsSince(G(e),r))):void 0,cleanup:e=>t.lockedRun((()=>n.cleanup(e))),remove:()=>(t.storageInstances.delete(i),t.lockedRun((()=>n.remove()))),close:()=>(t.storageInstances.delete(i),t.lockedRun((()=>n.close()))),changeStream:()=>n.changeStream(),conflictResultionTasks:()=>n.conflictResultionTasks(),resolveConflictResultionTask(e){if(e.output.isEqual)return n.resolveConflictResultionTask(e);var t=C(Object.assign({},e.output.documentData,{_meta:F(),_rev:"",_attachments:{}}));return delete t._meta,delete t._rev,delete t._attachments,n.resolveConflictResultionTask({id:e.id,output:{isEqual:!1,documentData:t}})}};return t.storageInstances.add(i),i}async function Si(e,t,n){if(e.getChangedDocumentsSince)return e.getChangedDocumentsSince(t,n);var r=z(e.schema.primaryKey),o=pi(e.schema,function(e,t,n){var r=z(e.schema.primaryKey),o=n?n.lwt:L,i=n?n.id:"";return Qo(e.schema,{selector:{$or:[{"_meta.lwt":{$gt:o}},{"_meta.lwt":{$eq:o},[r]:{$gt:n?i:""}}],"_meta.lwt":{$gte:o}},sort:[{"_meta.lwt":"asc"},{[r]:"asc"}],skip:0,limit:t})}(e,t,n)),i=(await e.query(o)).documents,s=N(i);return{documents:i,checkpoint:s?{id:s[r],lwt:s._meta.lwt}:n||{id:"",lwt:0}}}function Ii(e,t,n){var r=xi.get(n);if(r)return r;var o=[];if(n.error.length>0){for(var i=new Set,s=0;s<n.error.length;s++){var a=n.error[s];i.add(a.documentId)}for(var c=0;c<t.length;c++){var u=t[c].document;i.has(u[e])||o.push(wi(u))}}else{o.length=t.length-n.error.length;for(var l=0;l<t.length;l++){var h=t[l].document;o[l]=wi(h)}}return o}var Ei="15.30.2",Oi="15.30.2";function Di(e,t){var n=t.map((t=>{var n=K(e,t);if(!n)throw new Error("not in schema: "+t);var r,o=n.type;"number"!==o&&"integer"!==o||(r=Pi(n));var i,s=j(t),a=n.maxLength?n.maxLength:0;return i="string"===o?e=>{var t=s(e);return t||(t=""),t.padEnd(a," ")}:"boolean"===o?e=>s(e)?"1":"0":e=>{var t=s(e);return ji(r,t)},{fieldName:t,schemaPart:n,parsedLengths:r,getValue:s,getIndexStringPart:i}}));return n}function Pi(e){var t=Math.floor(e.minimum),n=Math.ceil(e.maximum),r=e.multipleOf,o=(n-t).toString().length,i=r.toString().split("."),s=0;return i.length>1&&(s=i[1].length),{minimum:t,maximum:n,nonDecimals:o,decimals:s,roundedMinimum:t}}function ji(e,t){void 0===t&&(t=0),t<e.minimum&&(t=e.minimum),t>e.maximum&&(t=e.maximum);var n=(Math.floor(t)-e.roundedMinimum).toString().padStart(e.nonDecimals,"0");if(e.decimals>0){var r=t.toString().split(".");n+=(r.length>1?r[1]:"0").padEnd(e.decimals,"0")}return n}function Ci(e,t,n){var r="";return t.forEach(((t,o)=>{var i=K(e,t),s=n[o],a=i.type;switch(a){case"string":var c=G(i.maxLength,"maxLength not set");r+="string"==typeof s?s.padEnd(c," "):"".padEnd(c," ");break;case"boolean":r+=null===s||s===kn?"0":s===xn||s?"1":"0";break;case"number":case"integer":var u=Pi(i);if(null===s||s===kn)r+="0".repeat(u.nonDecimals+u.decimals);else if(s===xn)r+=ji(u,u.maximum);else{var l=ji(u,s);r+=l}break;default:throw new Error("unknown index type "+a)}})),r}function Ri(e,t,n){var r="";return t.forEach(((t,o)=>{var i=K(e,t),s=n[o],a=i.type;switch(a){case"string":var c=G(i.maxLength,"maxLength not set");r+="string"==typeof s&&s!==xn?s.padEnd(c," "):"".padEnd(c,s===kn?" ":xn);break;case"boolean":r+=null===s||s?"1":"0";break;case"number":case"integer":var u=Pi(i);r+=null===s||s===xn?"9".repeat(u.nonDecimals+u.decimals):s===kn?"0".repeat(u.nonDecimals+u.decimals):ji(u,s);break;default:throw new Error("unknown index type "+a)}})),r}function Mi(e){return e.join("||")}function Ai(e,t){var n=Mi(t);return wn(e.indexIdByName,n)}var Ni={locale:null,unique:!1};function $i(e,t,n,r){for(var o={i:n,d:r,i0:void 0,i1:void 0,i2:void 0,i3:void 0,i4:void 0,i5:void 0,i6:void 0,i7:void 0},i=0;i<e;++i){var s=(0,t[i])(r);o["i"+i]=s}return o}var Bi=["_deleted","_meta.lwt"];function Ti(e){var t={},n=e.indexes?e.indexes.map((e=>Array.isArray(e)?e.slice(0):[e])):[];n.push(Bi);var r=new Map;return n.forEach(((n,o)=>{var i="i"+o,s=Mi(n);if(r.has(s))throw new Error("duplicate index "+s);r.set(s,i),t[i]=function(e,t){var n=Di(e,t),r=n.length,o=n.map((e=>e.getIndexStringPart));return function(e){for(var t="",n=0;n<r;++n)t+=o[n](e);return t}}(e,n)})),{indexIdByName:r,monadByIndexId:t}}Mi(Bi);var qi="documents",Li="wal",Fi="attachments",Ki={durability:"relaxed"},zi="indexeddb",Qi=0;function Wi(e,t){return e+"||"+t}var Hi=new Map;function Ui(e,t){var n=_n(Hi,e,(()=>Pt));return n=G(n).then((()=>t())),Hi.set(e,n),n}function Vi(e,t){t.onversionchange=n=>{e.closed||(t.close(),e.creationPromise=e.refreshIDBDatabase())}}async function Ji(e,t,n,r){var o=await _n(e.indexedDBStates,n.databaseName,(()=>async function(e,t,n){var r=Qi++,o=await function(e,t){return"function"==typeof t?t(e):t}(e,n.indexedDB),i=async()=>(await Et(0),Ui(e.databaseName,(()=>new Promise(((t,n)=>{var i=o.open(e.databaseName);i.onerror=function(t){console.error(r+": OPEN IDB DATABASE "+e.databaseName+" ERROR"),n(t)},i.onsuccess=function(e){var n=i.result;t(n),Vi(s,n)},Xi(s,i)}))))),s={indexedDB:o,debugId:r,closed:!1,storage:t,settings:n,refreshIDBDatabase:i,creationPromise:i(),name:e.databaseName,refCount:0,storesToOpen:[]};return s}(n,e,t)));return o.storesToOpen=o.storesToOpen.concat(r),o.refCount=o.refCount+1,o.creationPromise.then((()=>Gi(G(o)))).then((()=>G(o)))}async function Gi(e){if(0!==e.storesToOpen.length)return e.creationPromise=e.creationPromise.then((async t=>{var n=new Set(Array.from(t.objectStoreNames));if(0===e.storesToOpen.filter((e=>!n.has(Yi(e.collectionName,e.schema).documentStore))).length)return t;var r=t.version+1;return t.close(),Ui(e.name,(()=>new Promise((async(t,n)=>{var o=e.indexedDB.open(e.name,r);o.onerror=function(t){console.error(e.debugId+": ERROR openStoresOnExistingDatabase() openRequest: error "),n(t)},o.onsuccess=function(n){var r=o.result;Vi(e,r),t(r)},o.onblocked=e=>{},Xi(e,o)}))))})),e.creationPromise}function Yi(e,t){var n=t.version;return{documentStore:e+"-"+n+"-"+qi,writeAheadStore:e+"-"+n+"-"+Li,attachmentsStore:e+"-"+n+"-"+Fi}}function Xi(e,t){t.onupgradeneeded=function(n){var r=t.result;e.storesToOpen.forEach((e=>{var t=r.objectStoreNames,n=Yi(e.collectionName,e.schema);if(!t.contains(n.documentStore)){var o=r.createObjectStore(n.documentStore,{keyPath:"i",autoIncrement:!1});r.createObjectStore(n.writeAheadStore,{keyPath:"i",autoIncrement:!1}),function(e,t){t.indexIds.forEach((t=>{e.createIndex(t,t,Ni)}))}(o,e),e.schema.attachments&&r.createObjectStore(n.attachmentsStore,{keyPath:"docIdWithAttachmentId",autoIncrement:!1})}})),e.storesToOpen=[]}}function Zi(e){if(e.closed)throw new Error("RxStorageInstanceIndexedDB is closed "+e.databaseName+"-"+e.collectionName)}async function es(e,t){var n=e.primaryPath,r=e.internals.indexIds.length,o=e.internals.getIndexableStringByIndexNumber,i=t.objectStore(e.internals.storeNames.writeAheadStore),s=await new Promise(((e,t)=>{var n=i.get("documents");n.onerror=t,n.onsuccess=t=>{var r=n.result;e(r?JSON.parse(r.docsData):void 0)}}));if(s&&s.length>0){for(var a,c=t.objectStore(e.internals.storeNames.documentStore),u=0;u<s.length;++u){var l=s[u],h=$i(r,o,l[n],l);a=c.put(h)}await new Promise(((e,t)=>{a.onerror=t,a.onsuccess=()=>e(!0)})),i.delete("documents")}return t}async function ts(e){var t,n=[e.internals.storeNames.documentStore,e.internals.storeNames.writeAheadStore];e.schema.attachments&&n.push(e.internals.storeNames.attachmentsStore);for(var r=100;r>0;){var o=await e.internals.state.creationPromise;r-=1;try{t=o.transaction(n,"readwrite",Ki)}catch(t){if("InvalidStateError"!==t.name&&"NotFoundError"!==t.name||!(r>0))throw t;"NotFoundError"===t.name?await Gi(e.internals.state):e.internals.state.creationPromise=e.internals.state.refreshIDBDatabase()}}return await es(e,G(t)),G(t)}var ns=function(){function e(e){this.allTasksRuns=[],this.instance=e,this.txPromise=ts(this.instance).then((t=>es(e,t)))}return e.prototype.addTask=function(e){var t=this.txPromise.then((t=>e(t))),n=t.catch((()=>null));this.allTasksRuns.push(n);var r=this.allTasksRuns.length;return n.then((()=>Promise.all(this.allTasksRuns))).then((()=>{this.allTasksRuns.length===r&&(this.instance.openReadonlyTransaction=void 0)})),t.catch((t=>{if("TransactionInactiveError"===t.name)return this.instance.openReadonlyTransaction=void 0,rs(this.instance,e);throw t}))},e}();function rs(e,t){return e.openReadonlyTransaction||(e.openReadonlyTransaction=new ns(e)),e.openReadonlyTransaction.addTask(t)}var os=Array.isArray;function is(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=lt(e),r=ht(e,1/0);return e=function(e){return 1===e.length&&os(e[0])?e[0]:e}(e),Qe((function(t,o){at(r)(vt(se([t],ie(e)),n)).subscribe(o)}))}Promise.resolve(!1),Promise.resolve(!0);var ss=Promise.resolve();function as(e,t){return e||(e=0),new Promise((function(n){return setTimeout((function(){return n(t)}),e)}))}function cs(){return Math.random().toString(36).substring(2)}var us=0;function ls(){var e=1e3*Date.now();return e<=us&&(e=us+1),us=e,e}var hs={create:function(e){var t={time:ls(),messagesCallback:null,bc:new BroadcastChannel(e),subFns:[]};return t.bc.onmessage=function(e){t.messagesCallback&&t.messagesCallback(e.data)},t},close:function(e){e.bc.close(),e.subFns=[]},onMessage:function(e,t){e.messagesCallback=t},postMessage:function(e,t){try{return e.bc.postMessage(t,!1),ss}catch(e){return Promise.reject(e)}},canBeUsed:function(){if("undefined"!=typeof globalThis&&globalThis.Deno&&globalThis.Deno.args)return!0;if("undefined"==typeof window&&"undefined"==typeof self||"function"!=typeof BroadcastChannel)return!1;if(BroadcastChannel._pubkey)throw new Error("BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill");return!0},type:"native",averageResponseTime:function(){return 150},microSeconds:ls};class ds{ttl;map=new Map;_to=!1;constructor(e){this.ttl=e}has(e){return this.map.has(e)}add(e){this.map.set(e,fs()),this._to||(this._to=!0,setTimeout((()=>{this._to=!1,function(e){const t=fs()-e.ttl,n=e.map[Symbol.iterator]();for(;;){const r=n.next().value;if(!r)return;const o=r[0];if(!(r[1]<t))return;e.map.delete(o)}}(this)}),0))}clear(){this.map.clear()}}function fs(){return Date.now()}function ms(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=JSON.parse(JSON.stringify(e));return void 0===t.webWorkerSupport&&(t.webWorkerSupport=!0),t.idb||(t.idb={}),t.idb.ttl||(t.idb.ttl=45e3),t.idb.fallbackInterval||(t.idb.fallbackInterval=150),e.idb&&"function"==typeof e.idb.onclose&&(t.idb.onclose=e.idb.onclose),t.localstorage||(t.localstorage={}),t.localstorage.removeTimeout||(t.localstorage.removeTimeout=6e4),e.methods&&(t.methods=e.methods),t.node||(t.node={}),t.node.ttl||(t.node.ttl=12e4),t.node.maxParallelWrites||(t.node.maxParallelWrites=2048),void 0===t.node.useFastPath&&(t.node.useFastPath=!0),t}var ps="pubkey.broadcast-channel-0-",vs="messages",ys={durability:"relaxed"};function gs(){if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof window){if(void 0!==window.mozIndexedDB)return window.mozIndexedDB;if(void 0!==window.webkitIndexedDB)return window.webkitIndexedDB;if(void 0!==window.msIndexedDB)return window.msIndexedDB}return!1}function bs(e){e.commit&&e.commit()}function ws(e,t){var n=e.transaction(vs,"readonly",ys),r=n.objectStore(vs),o=[],i=IDBKeyRange.bound(t+1,1/0);if(r.getAll){var s=r.getAll(i);return new Promise((function(e,t){s.onerror=function(e){return t(e)},s.onsuccess=function(t){e(t.target.result)}}))}return new Promise((function(e,s){var a=function(){try{return i=IDBKeyRange.bound(t+1,1/0),r.openCursor(i)}catch(e){return r.openCursor()}}();a.onerror=function(e){return s(e)},a.onsuccess=function(r){var i=r.target.result;i?i.value.id<t+1?i.continue(t+1):(o.push(i.value),i.continue()):(bs(n),e(o))}}))}function _s(e){return(t=e.db,n=e.options.idb.ttl,r=Date.now()-n,o=t.transaction(vs,"readonly",ys),i=o.objectStore(vs),s=[],new Promise((function(e){i.openCursor().onsuccess=function(t){var n=t.target.result;if(n){var i=n.value;i.time<r?(s.push(i),n.continue()):(bs(o),e(s))}else e(s)}}))).then((function(t){return function(e,t){if(e.closed)return Promise.resolve([]);var n=e.db.transaction(vs,"readwrite",ys).objectStore(vs);return Promise.all(t.map((function(e){var t=n.delete(e);return new Promise((function(e){t.onsuccess=function(){return e()}}))})))}(e,t.map((function(e){return e.id})))}));var t,n,r,o,i,s}function xs(e){e.closed||ks(e).then((function(){return as(e.options.idb.fallbackInterval)})).then((function(){return xs(e)}))}function ks(e){return e.closed?ss:e.messagesCallback?ws(e.db,e.lastCursorId).then((function(t){var n=t.filter((function(e){return!!e})).map((function(t){return t.id>e.lastCursorId&&(e.lastCursorId=t.id),t})).filter((function(t){return function(e,t){return!(e.uuid===t.uuid||t.eMIs.has(e.id)||e.data.time<t.messagesCallbackTime)}(t,e)})).sort((function(e,t){return e.time-t.time}));return n.forEach((function(t){e.messagesCallback&&(e.eMIs.add(t.id),e.messagesCallback(t.data))})),ss})):ss}var Ss={create:function(e,t){return t=ms(t),function(e){var t=gs(),n=ps+e,r=t.open(n);return r.onupgradeneeded=function(e){e.target.result.createObjectStore(vs,{keyPath:"id",autoIncrement:!0})},new Promise((function(e,t){r.onerror=function(e){return t(e)},r.onsuccess=function(){e(r.result)}}))}(e).then((function(n){var r={closed:!1,lastCursorId:0,channelName:e,options:t,uuid:cs(),eMIs:new ds(2*t.idb.ttl),writeBlockPromise:ss,messagesCallback:null,readQueuePromises:[],db:n};return n.onclose=function(){r.closed=!0,t.idb.onclose&&t.idb.onclose()},xs(r),r}))},close:function(e){e.closed=!0,e.db.close()},onMessage:function(e,t,n){e.messagesCallbackTime=n,e.messagesCallback=t,ks(e)},postMessage:function(e,t){return e.writeBlockPromise=e.writeBlockPromise.then((function(){return function(e,t,n){var r={uuid:t,time:Date.now(),data:n},o=e.transaction([vs],"readwrite",ys);return new Promise((function(e,t){o.oncomplete=function(){return e()},o.onerror=function(e){return t(e)},o.objectStore(vs).add(r),bs(o)}))}(e.db,e.uuid,t)})).then((function(){var t,n;0===(t=0,n=10,Math.floor(Math.random()*(n-t+1)+t))&&_s(e)})),e.writeBlockPromise},canBeUsed:function(){return!!gs()},type:"idb",averageResponseTime:function(e){return 2*e.idb.fallbackInterval},microSeconds:ls},Is="pubkey.broadcastChannel-";function Es(){var e;if("undefined"==typeof window)return null;try{e=window.localStorage,e=window["ie8-eventlistener/storage"]||window.localStorage}catch(e){}return e}function Os(e){return Is+e}function Ds(){var e=Es();if(!e)return!1;try{var t="__broadcastchannel_check";e.setItem(t,"works"),e.removeItem(t)}catch(e){return!1}return!0}var Ps,js={create:function(e,t){if(t=ms(t),!Ds())throw new Error("BroadcastChannel: localstorage cannot be used");var n=cs(),r=new ds(t.localstorage.removeTimeout),o={channelName:e,uuid:n,eMIs:r};return o.listener=function(e,t){var n=Os(e),r=function(e){e.key===n&&t(JSON.parse(e.newValue))};return window.addEventListener("storage",r),r}(e,(function(e){o.messagesCallback&&e.uuid!==n&&e.token&&!r.has(e.token)&&(e.data.time&&e.data.time<o.messagesCallbackTime||(r.add(e.token),o.messagesCallback(e.data)))})),o},close:function(e){var t;t=e.listener,window.removeEventListener("storage",t)},onMessage:function(e,t,n){e.messagesCallbackTime=n,e.messagesCallback=t},postMessage:function(e,t){return new Promise((function(n){as().then((function(){var r=Os(e.channelName),o={token:cs(),time:Date.now(),data:t,uuid:e.uuid},i=JSON.stringify(o);Es().setItem(r,i);var s=document.createEvent("Event");s.initEvent("storage",!0,!0),s.key=r,s.newValue=i,window.dispatchEvent(s),n()}))}))},canBeUsed:Ds,type:"localstorage",averageResponseTime:function(){var e=navigator.userAgent.toLowerCase();return e.includes("safari")&&!e.includes("chrome")?240:120},microSeconds:ls},Cs=ls,Rs=new Set,Ms={create:function(e){var t={time:Cs(),name:e,messagesCallback:null};return Rs.add(t),t},close:function(e){Rs.delete(e)},onMessage:function(e,t){e.messagesCallback=t},postMessage:function(e,t){return new Promise((function(n){return setTimeout((function(){Array.from(Rs).forEach((function(n){n.name===e.name&&n!==e&&n.messagesCallback&&n.time<t.time&&n.messagesCallback(t)})),n()}),5)}))},canBeUsed:function(){return!0},type:"simulate",averageResponseTime:function(){return 5},microSeconds:Cs},As=[hs,Ss,js],Ns=new Set,$s=0,Bs=function(e,t){var n,r,o;this.id=$s++,Ns.add(this),this.name=e,Ps&&(t=Ps),this.options=ms(t),this.method=function(e){var t=[].concat(e.methods,As).filter(Boolean);if(e.type){if("simulate"===e.type)return Ms;var n=t.find((function(t){return t.type===e.type}));if(n)return n;throw new Error("method-type "+e.type+" not found")}e.webWorkerSupport||(t=t.filter((function(e){return"idb"!==e.type})));var r=t.find((function(e){return e.canBeUsed()}));if(r)return r;throw new Error("No usable method found in "+JSON.stringify(As.map((function(e){return e.type}))))}(this.options),this._iL=!1,this._onML=null,this._addEL={message:[],internal:[]},this._uMP=new Set,this._befC=[],this._prepP=null,(o=r=(n=this).method.create(n.name,n.options))&&"function"==typeof o.then?(n._prepP=r,r.then((function(e){n._state=e}))):n._state=r};function Ts(e,t,n){var r={time:e.method.microSeconds(),type:t,data:n};return(e._prepP?e._prepP:ss).then((function(){var t=e.method.postMessage(e._state,r);return e._uMP.add(t),t.catch().then((function(){return e._uMP.delete(t)})),t}))}function qs(e){return e._addEL.message.length>0||e._addEL.internal.length>0}function Ls(e,t,n){e._addEL[t].push(n),function(e){if(!e._iL&&qs(e)){var t=function(t){e._addEL[t.type].forEach((function(e){t.time>=e.time&&e.fn(t.data)}))},n=e.method.microSeconds();e._prepP?e._prepP.then((function(){e._iL=!0,e.method.onMessage(e._state,t,n)})):(e._iL=!0,e.method.onMessage(e._state,t,n))}}(e)}function Fs(e,t,n){e._addEL[t]=e._addEL[t].filter((function(e){return e!==n})),function(e){if(e._iL&&!qs(e)){e._iL=!1;var t=e.method.microSeconds();e.method.onMessage(e._state,null,t)}}(e)}Bs._pubkey=!0,Bs.prototype={postMessage:function(e){if(this.closed)throw new Error("BroadcastChannel.postMessage(): Cannot post message after channel has closed "+JSON.stringify(e));return Ts(this,"message",e)},postInternal:function(e){return Ts(this,"internal",e)},set onmessage(e){var t={time:this.method.microSeconds(),fn:e};Fs(this,"message",this._onML),e&&"function"==typeof e?(this._onML=t,Ls(this,"message",t)):this._onML=null},addEventListener:function(e,t){Ls(this,e,{time:this.method.microSeconds(),fn:t})},removeEventListener:function(e,t){Fs(this,e,this._addEL[e].find((function(e){return e.fn===t})))},close:function(){var e=this;if(!this.closed){Ns.delete(this),this.closed=!0;var t=this._prepP?this._prepP:ss;return this._onML=null,this._addEL.message=[],t.then((function(){return Promise.all(Array.from(e._uMP))})).then((function(){return Promise.all(e._befC.map((function(e){return e()})))})).then((function(){return e.method.close(e._state)}))}},get type(){return this.method.type},get isClosed(){return this.closed}};var Ks=new Map;function zs(e,t){var n=Ks.get(e);if(n)return n.refs.delete(t),0===n.refs.size?(Ks.delete(e),n.bc.close()):void 0}function Qs(e,t,n,r){if(t.multiInstance){var o=r||function(e,t,n,r){var o=Ks.get(t);return o||(o={bc:new Bs(["RxDB:",e,n].join("|")),refs:new Set},Ks.set(t,o)),o.refs.add(r),o.bc}(e,t.databaseInstanceToken,n.databaseName,n),i=new Le,s=n=>{n.storageName===e&&n.databaseName===t.databaseName&&n.collectionName===t.collectionName&&n.version===t.schema.version&&i.next(n.eventBulk)};o.addEventListener("message",s);var a=n.changeStream(),c=!1,u=a.subscribe((n=>{c||o.postMessage({storageName:e,databaseName:t.databaseName,collectionName:t.collectionName,version:t.schema.version,eventBulk:n})}));n.changeStream=function(){return i.asObservable().pipe(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return is.apply(void 0,se([],ie(e)))}(a))};var l=n.close.bind(n);n.close=async function(){return c=!0,u.unsubscribe(),o.removeEventListener("message",s),r||await zs(t.databaseInstanceToken,n),l()};var h=n.remove.bind(n);n.remove=async function(){return c=!0,u.unsubscribe(),o.removeEventListener("message",s),r||await zs(t.databaseInstanceToken,n),h()}}}async function Ws(e,t){return rs(e,(async n=>{var r=t.queryPlan,o=t.query,i=o.skip?o.skip:0,s=i+(o.limit?o.limit:1/0),a=e.internals.storeNames.documentStore,c=e.settings.batchSize?e.settings.batchSize:50,u=!1;r.selectorSatisfiedByIndex||(u=Ho(e.schema,o));var l,h=r.index,d=!r.sortSatisfiedByIndex,f=h,m=r.startKeys,p=Ci(e.schema,f,m),v=r.endKeys,y=Ri(e.schema,f,v),g=[],b=n.objectStore(a),w=Ai(e.internals,f);l=b.index(w),u||t.query.limit||(c=1e5);var _=!1;if(await async function(e,t,n,r,o,i,s,a){var c=e.settings.IDBKeyRange?e.settings.IDBKeyRange:IDBKeyRange,u=e.internals.getIndexableStringByIndexId[s];if("function"==typeof n.getAll&&1!==r)for(var l,h=!0,d=!1,f=async function(){l&&(o=u(l.d));var e=c.bound(o,i,!h||!t.inclusiveStart,!t.inclusiveEnd);h=!1;var s=n.getAll(e,r);await new Promise(((e,t)=>{s.onerror=t,s.onsuccess=t=>{var n=t.target.result;l=N(n),0!==n.length&&!1===a(n)&&(d=!0),n.length<r&&(d=!0),e()}}))};!d;)await f();else{var m=c.bound(o,i,!t.inclusiveStart,!t.inclusiveEnd),p=n.openCursor(m);await new Promise((e=>{p.onsuccess=function(t){var n=t.target.result;if(n){var r=n.value;a([r])?n.continue():e()}else e()}}))}}(e,r,l,c,p,y,w,(e=>{for(var t=0;t<e.length;t++){var n=e[t].d;if(_||u&&!u(n)||g.push(n),!d&&g.length===s){_=!0;break}}return!_})),d){var x=Wo(e.schema,o);g=g.sort(x)}return{documents:g=g.slice(i,s)}}))}async function Hs(e,t,n){var r=e.primaryPath,o=e.internals,i=e.internals.state;await i.creationPromise;var s=[o.storeNames.documentStore,o.storeNames.writeAheadStore];e.schema.attachments&&s.push(o.storeNames.attachmentsStore),Zi(e);var a,c=await ts(e),u=c.objectStore(o.storeNames.documentStore);a=0===e.internals.minKnownDocsAmount&&t.length>30&&!await function(e,t){var n=(e.settings.IDBKeyRange?e.settings.IDBKeyRange:IDBKeyRange).lowerBound(kn,!0),r=t.getKey(n);return new Promise((e=>{r.onsuccess=()=>{e(!!r.result)}}))}(e,u)?new Map:await function(e,t,n){var r=n.length,o=new Map;if(0===r)return Promise.resolve(o);for(var i=new Array(r),s=0;s<r;s++){var a=n[s].document[e],c=t.get(a);i[s]=c}var u=G(N(i));return new Promise(((t,n)=>{u.onerror=n,u.onsuccess=()=>{for(var n=0;n<r;n++){var s=i[n].result;if(s){var a=s.d,c=a[e];o.set(c,a)}}t(o)}}))}(r,u,t);for(var l=function(e,t,n,r,o,i,s){for(var a,c=!!e.schema.attachments,u=[],l=[],h=[],d={id:_(10),events:[],checkpoint:null,context:o,startTime:J(),endTime:0},f=d.events,m=[],v=[],y=[],g=n.size>0,b=r.length,w=function(){var e,o=r[x],d=o.document,b=o.previous,w=d[t],_=d._deleted,k=b&&b._deleted,S=void 0;if(g&&(S=n.get(w)),S){var I=S._rev;if(!b||b&&I!==b._rev){var E={isError:!0,status:409,documentId:w,writeRow:o,documentInDb:S};return h.push(E),1}var O=c?bi(o):o;c&&(_?b&&Object.keys(b._attachments).forEach((e=>{v.push({documentId:w,attachmentId:e,digest:G(b)._attachments[e].digest})})):(Object.entries(d._attachments).find((([t,n])=>((b?b._attachments[t]:void 0)||n.data||(e={documentId:w,documentInDb:S,isError:!0,status:510,writeRow:o,attachmentId:t}),!0))),e||Object.entries(d._attachments).forEach((([e,t])=>{var n=b?b._attachments[e]:void 0;if(n){var r=O.document._attachments[e].digest;t.data&&n.digest!==r&&y.push({documentId:w,attachmentId:e,attachmentData:t,digest:t.digest})}else m.push({documentId:w,attachmentId:e,attachmentData:t,digest:t.digest})})))),e?h.push(e):(c?(l.push(bi(O)),s&&s(d)):(l.push(O),s&&s(d)),a=O);var D=null,P=null,j=null;if(k&&!_)j="INSERT",D=c?wi(d):d;else if(!b||k||_){if(!_)throw p("SNH",{args:{writeRow:o}});j="DELETE",D=G(d),P=b}else j="UPDATE",D=c?wi(d):d,P=b;var C={documentId:w,documentData:D,previousDocumentData:P,operation:j};f.push(C)}else{var R=!!_;if(c&&Object.entries(d._attachments).forEach((([t,n])=>{n.data?m.push({documentId:w,attachmentId:t,attachmentData:n,digest:n.digest}):(e={documentId:w,isError:!0,status:510,writeRow:o,attachmentId:t},h.push(e))})),e||(c?(u.push(bi(o)),i&&i(d)):(u.push(o),i&&i(d)),a=o),!R){var M={documentId:w,operation:"INSERT",documentData:c?wi(d):d,previousDocumentData:c&&b?wi(b):b};f.push(M)}}},x=0;x<b;x++)w();return{bulkInsertDocs:u,bulkUpdateDocs:l,newestRow:a,errors:h,eventBulk:d,attachmentsAdd:m,attachmentsRemove:v,attachmentsUpdate:y}}(e,r,a,t,n),h=l.errors,d=l.bulkInsertDocs,f=new Array(d.length),m=0;m<d.length;++m){var v=d[m].document;f[m]=v}for(var y=l.bulkUpdateDocs,g=0;g<y.length;++g){var b=y[g].document;f.push(b)}if(f.length>0){var w=c.objectStore(o.storeNames.writeAheadStore).put({i:"documents",docsData:JSON.stringify(f)});await new Promise(((e,t)=>{w.onerror=t,w.onsuccess=e})),e.handleWalIdlePromise||Et(100).then((()=>jt())).then((async()=>{e.handleWalIdlePromise=void 0,e.closed||await rs(e,(()=>Ot))}))}var x=void 0;if(e.schema.attachments){var k=c.objectStore(e.internals.storeNames.attachmentsStore);l.attachmentsAdd.forEach((e=>{x=k.put({docIdWithAttachmentId:Wi(e.documentId,e.attachmentId),length:e.attachmentData.length,type:e.attachmentData.type,data:e.attachmentData.data})})),l.attachmentsUpdate.forEach((e=>{x=k.put({docIdWithAttachmentId:Wi(e.documentId,e.attachmentId),length:e.attachmentData.length,type:e.attachmentData.type,data:e.attachmentData.data})})),l.attachmentsRemove.forEach((e=>{x=k.delete(Wi(e.documentId,e.attachmentId))}))}if(x&&await new Promise(((e,t)=>{G(x).onerror=t,G(x).onsuccess=e})),c.commit&&c.commit(),l.eventBulk.events.length>0){var S=G(l.newestRow).document;l.eventBulk.checkpoint={id:S[r],lwt:S._meta.lwt},l.eventBulk.endTime=J(),e.changes$.next(l.eventBulk)}return{error:h}}var Us=J(),Vs=function(){function e(e,t,n,r,o,i,s){this.changes$=new Le,this.instanceId=Us++,this.storage=e,this.databaseName=t,this.collectionName=n,this.schema=r,this.internals=o,this.options=i,this.settings=s,this.primaryPath=z(this.schema.primaryKey)}var t=e.prototype;return t.updateMinKnownDocs=function(e){this.internals.minKnownDocsAmount<e&&(this.internals.minKnownDocsAmount=e)},t.bulkWrite=async function(e,t){var n=await Hs(this,e,t);return this.updateMinKnownDocs(e.length-n.error.length),n},t.findDocumentsById=async function(e,t){Zi(this);var n=await rs(this,(async n=>function(e,t,n){var r=t.length;if(0===r)return Promise.resolve([]);for(var o=new Array,i=0;i<r;i++){var s=t[i];o.push(e.get(s))}var a=[],c=G(N(o));return new Promise(((e,t)=>{c.onerror=t,c.onsuccess=()=>{for(var t=0;t<r;t++){var i=o[t].result;if(i){var s=i.d;!n&&s._deleted||a.push(s)}}e(a)}}))}(n.objectStore(this.internals.storeNames.documentStore),e,t)));return this.updateMinKnownDocs(n.length),n},t.query=async function(e){await this.internals.state.creationPromise,Zi(this);var t=await Ws(this,e);return this.updateMinKnownDocs(t.documents.length),t},t.count=async function(e){if(e.queryPlan.selectorSatisfiedByIndex){var t=await async function(e,t){return rs(e,(async n=>{var r,o,i=t.queryPlan,s=e.internals.storeNames.documentStore,a=i.index,c=a,u=i.startKeys,l=Ci(e.schema,c,u),h=i.endKeys,d=Ri(e.schema,c,h),f=n.objectStore(s);o=1===a.length&&a[0]===e.primaryPath?Ai(e.internals,["_deleted",e.primaryPath]):Ai(e.internals,c),r=f.index(o);var m=(e.settings.IDBKeyRange?e.settings.IDBKeyRange:IDBKeyRange).bound(l,d,!i.inclusiveStart,!i.inclusiveEnd),p=r.count(m);return{count:await new Promise(((e,t)=>{p.onsuccess=function(){e(p.result)},p.onerror=t})),mode:"fast"}}))}(this,e);return this.updateMinKnownDocs(t.count),t}var n=await Ws(this,e);return this.updateMinKnownDocs(n.documents.length),{count:n.documents.length,mode:"slow"}},t.changeStream=function(){return this.changes$.asObservable()},t.cleanup=async function(e){var t=this.internals.state;await t.creationPromise;var n=this.settings.IDBKeyRange;return Zi(this),rs(this,(async t=>{var r=t.objectStore(this.internals.storeNames.documentStore),o=this.settings.batchSize,i=J()-e,s=Ai(this.internals,Bi),a=r.index(s),c=Ci(this.schema,Bi,[!0,1]),u=Ri(this.schema,Bi,[!0,i]),l=n.bound(c,u,!0,!0),h=await new Promise(((e,t)=>{var n=a.getAll(l,o);n.onerror=t,n.onsuccess=function(t){e(t.target.result)}}));return await Promise.all(h.map((e=>new Promise(((t,n)=>{var o=e.i,i=r.delete(o);i.onerror=n,i.onsuccess=()=>t()}))))),h.length<o}))},t.remove=async function(){var e=this.internals.state;return await e.creationPromise,Zi(this),rs(this,(async e=>{var t=[e.objectStore(this.internals.storeNames.documentStore),e.objectStore(this.internals.storeNames.writeAheadStore)];return this.schema.attachments&&t.push(e.objectStore(this.internals.storeNames.attachmentsStore)),await Promise.all(t.map((e=>new Promise(((t,n)=>{var r=e.clear();r.onerror=n,r.onsuccess=t}))))),this.close()}))},t.getAttachmentData=async function(e,t){var n=this.internals.state;return await n.creationPromise,Zi(this),rs(this,(n=>{var r=n.objectStore(this.internals.storeNames.attachmentsStore),o=Wi(e,t);return new Promise(((n,i)=>{var s=r.get(o);s.onsuccess=()=>{var r=s.result;r?n(r.data):i("attachment missing documentId: "+e+" attachmentId: "+t)}}))}))},t.close=async function(){return this.closed||(this.closed=(async()=>(await this.internals.state.creationPromise,await rs(this,(async e=>{})),this.changes$.complete(),async function(e){if(!e.closed&&(e.refCount=e.refCount-1,0===e.refCount))return e.closed=!0,e.storage.indexedDBStates.delete(e.name),e.creationPromise.then((e=>e.close()))}(this.internals.state)))()),this.closed},t.conflictResultionTasks=function(){return(new Le).asObservable()},t.resolveConflictResultionTask=function(e){return Pt},e}(),Js=function(){function e(e){this.name=zi,this.rxdbVersion=Oi,this.indexedDBStates=new Map,this.settings=e}return e.prototype.createStorageInstance=function(e){return function(e){if(e.schema.keyCompression)throw p("UT5",{args:{params:e}});if((t=e.schema).encrypted&&t.encrypted.length>0||t.attachments&&t.attachments.encrypted)throw p("UT6",{args:{params:e}});var t;if(e.schema.attachments&&e.schema.attachments.compression)throw p("UT7",{args:{params:e}})}(e),async function(e,t,n){var r=Ti(t.schema),o=Array.from(r.indexIdByName.values()),i=await Ji(e,n,t,[{collectionName:t.collectionName,schema:t.schema,indexIds:o}]);await i.creationPromise;var s={state:i,storeNames:Yi(t.collectionName,t.schema),getIndexableStringByIndexId:r.monadByIndexId,getIndexableStringByIndexNumber:Object.values(r.monadByIndexId),indexIdByName:r.indexIdByName,indexNames:Object.keys(r),indexIds:o,minKnownDocsAmount:0},a=new Vs(e,t.databaseName,t.collectionName,t.schema,s,t.options,n);return await Qs(zi,t,a),a}(this,e,Object.assign({},this.settings,e.options))},e}();function Gs(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){if(e.constructor!==t.constructor)return!1;var n,r;if(Array.isArray(e)){if((n=e.length)!==t.length)return!1;for(r=n;0!=r--;)if(!Gs(e[r],t[r]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();var o=Object.keys(e);if((n=o.length)!==Object.keys(t).length)return!1;for(r=n;0!=r--;)if(!Object.prototype.hasOwnProperty.call(t,o[r]))return!1;for(r=n;0!=r--;){var i=o[r];if(!Gs(e[i],t[i]))return!1}return!0}return e!=e&&t!=t}function Ys(e,t){return{connectionId:e.connectionId,answerTo:e.requestId,method:e.method,error:(n=t,{name:n.name,message:n.message,rxdb:n.rxdb,parameters:n.parameters,extensions:n.extensions,code:n.code,url:n.url,stack:n.stack?n.stack.replace(/\n/g," \n "):void 0})};var n}function Xs(e,t){return{connectionId:e.connectionId,answerTo:e.requestId,method:e.method,return:t}}var Zs=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this._parallels=e||1,this._qC=0,this._iC=new Set,this._lHN=0,this._hPM=new Map,this._pHM=new Map};function ea(e,t){if(t){if(t._timeoutObj&&clearTimeout(t._timeoutObj),e._pHM.has(t)){var n=e._pHM.get(t);e._hPM.delete(n),e._pHM.delete(t)}e._iC.delete(t)}}function ta(e){e._tryIR||0===e._iC.size||(e._tryIR=!0,setTimeout((function(){e.isIdle()?setTimeout((function(){e.isIdle()?(function(e){0!==e._iC.size&&(e._iC.values().next().value._manRes(),setTimeout((function(){return ta(e)}),0))}(e),e._tryIR=!1):e._tryIR=!1}),0):e._tryIR=!1}),0))}Zs.prototype={isIdle:function(){return this._qC<this._parallels},lock:function(){this._qC++},unlock:function(){this._qC--,ta(this)},wrapCall:function(e){var t,n=this;this.lock();try{t=e()}catch(e){throw this.unlock(),e}return t.then&&"function"==typeof t.then?t.then((function(e){return n.unlock(),e})).catch((function(e){throw n.unlock(),e})):(this.unlock(),t)},requestIdlePromise:function(e){var t,n=this;e=e||{};var r=new Promise((function(e){return t=e}));if(r._manRes=function(){ea(n,r),t()},e.timeout){var o=setTimeout((function(){r._manRes()}),e.timeout);r._timeoutObj=o}return this._iC.add(r),ta(this),r},cancelIdlePromise:function(e){ea(this,e)},requestIdleCallback:function(e,t){var n=this._lHN++,r=this.requestIdlePromise(t);return this._hPM.set(n,r),this._pHM.set(r,n),r.then((function(){return e()})),n},cancelIdleCallback:function(e){var t=this._hPM.get(e);this.cancelIdlePromise(t)},clear:function(){var e=this;this._iC.forEach((function(t){return ea(e,t)})),this._qC=0,this._iC.clear(),this._hPM=new Map,this._pHM=new Map}},Object.freeze({ignoreUnknown:!1,respectType:!1,respectFunctionNames:!1,respectFunctionProperties:!1,unorderedObjects:!0,unorderedArrays:!1,unorderedSets:!1,excludeKeys:void 0,excludeValues:void 0,replacer:void 0}),Object.freeze(["prototype","__proto__","constructor"]);class na{constructor(e,t){e=this.words=e||[],this.sigBytes=void 0===t?4*e.length:t}toString(e){return(e||ra).stringify(this)}concat(e){if(this.clamp(),this.sigBytes%4)for(let t=0;t<e.sigBytes;t++){const n=e.words[t>>>2]>>>24-t%4*8&255;this.words[this.sigBytes+t>>>2]|=n<<24-(this.sigBytes+t)%4*8}else for(let t=0;t<e.sigBytes;t+=4)this.words[this.sigBytes+t>>>2]=e.words[t>>>2];return this.sigBytes+=e.sigBytes,this}clamp(){this.words[this.sigBytes>>>2]&=4294967295<<32-this.sigBytes%4*8,this.words.length=Math.ceil(this.sigBytes/4)}clone(){return new na([...this.words])}}const ra={stringify(e){const t=[];for(let n=0;n<e.sigBytes;n++){const r=e.words[n>>>2]>>>24-n%4*8&255;t.push((r>>>4).toString(16),(15&r).toString(16))}return t.join("")}},oa={parse(e){const t=e.length,n=[];for(let r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new na(n,t)}},ia={parse:e=>oa.parse(unescape(encodeURIComponent(e)))};class sa{constructor(){this._data=new na,this._nDataBytes=0,this._minBufferSize=0,this.blockSize=16}reset(){this._data=new na,this._nDataBytes=0}_append(e){"string"==typeof e&&(e=ia.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes}_doProcessBlock(e,t){}_process(e){let t,n=this._data.sigBytes/(4*this.blockSize);n=e?Math.ceil(n):Math.max((0|n)-this._minBufferSize,0);const r=n*this.blockSize,o=Math.min(4*r,this._data.sigBytes);if(r){for(let e=0;e<r;e+=this.blockSize)this._doProcessBlock(this._data.words,e);t=this._data.words.splice(0,r),this._data.sigBytes-=o}return new na(t,o)}}class aa extends sa{update(e){return this._append(e),this._process(),this}finalize(e){e&&this._append(e)}}const ca=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],ua=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],la=[];class ha extends aa{constructor(){super(...arguments),this._hash=new na([...ca])}reset(){super.reset(),this._hash=new na([...ca])}_doProcessBlock(e,t){const n=this._hash.words;let r=n[0],o=n[1],i=n[2],s=n[3],a=n[4],c=n[5],u=n[6],l=n[7];for(let n=0;n<64;n++){if(n<16)la[n]=0|e[t+n];else{const e=la[n-15],t=(e<<25|e>>>7)^(e<<14|e>>>18)^e>>>3,r=la[n-2],o=(r<<15|r>>>17)^(r<<13|r>>>19)^r>>>10;la[n]=t+la[n-7]+o+la[n-16]}const h=r&o^r&i^o&i,d=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),f=l+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&c^~a&u)+ua[n]+la[n];l=u,u=c,c=a,a=s+f|0,s=i,i=o,o=r,r=f+(d+h)|0}n[0]=n[0]+r|0,n[1]=n[1]+o|0,n[2]=n[2]+i|0,n[3]=n[3]+s|0,n[4]=n[4]+a|0,n[5]=n[5]+c|0,n[6]=n[6]+u|0,n[7]=n[7]+l|0}finalize(e){super.finalize(e);const t=8*this._nDataBytes,n=8*this._data.sigBytes;return this._data.words[n>>>5]|=128<<24-n%32,this._data.words[14+(n+64>>>9<<4)]=Math.floor(t/4294967296),this._data.words[15+(n+64>>>9<<4)]=t,this._data.sigBytes=4*this._data.words.length,this._process(),this._hash}}var da="undefined"!=typeof crypto&&void 0!==crypto.subtle&&"function"==typeof crypto.subtle.digest?async function(e){var t=(new TextEncoder).encode(e),n=await crypto.subtle.digest("SHA-256",t);return Array.prototype.map.call(new Uint8Array(n),(e=>("00"+e.toString(16)).slice(-2))).join("")}:function(e){return Promise.resolve((t=e,(new ha).finalize(t).toString()));var t},fa=function(){function e(e,t){this.jsonSchema=e,this.hashFunction=t,this.indexes=function(e){return(e.indexes||[]).map((e=>$(e)?e:[e]))}(this.jsonSchema),this.primaryPath=z(this.jsonSchema.primaryKey),this.finalFields=U(this.jsonSchema)}var t=e.prototype;return t.validateChange=function(e,t){this.finalFields.forEach((n=>{if(!Gs(e[n],t[n]))throw p("DOC9",{dataBefore:e,dataAfter:t,fieldName:n,schema:this.jsonSchema})}))},t.getDocumentPrototype=function(){var e={},t=K(this.jsonSchema,"");return Object.keys(t).forEach((t=>{var n=t;e.__defineGetter__(t,(function(){if(this.get&&"function"==typeof this.get)return this.get(n)})),Object.defineProperty(e,t+"$",{get:function(){return this.get$(n)},enumerable:!1,configurable:!1}),Object.defineProperty(e,t+"$$",{get:function(){return this.get$$(n)},enumerable:!1,configurable:!1}),Object.defineProperty(e,t+"_",{get:function(){return this.populate(n)},enumerable:!1,configurable:!1})})),A(this,"getDocumentPrototype",(()=>e)),e},t.getPrimaryOfDocumentData=function(e){return Q(this.jsonSchema,e)},o(e,[{key:"version",get:function(){return this.jsonSchema.version}},{key:"defaultValues",get:function(){var e={};return Object.entries(this.jsonSchema.properties).filter((([,e])=>Object.prototype.hasOwnProperty.call(e,"default"))).forEach((([t,n])=>e[t]=n.default)),A(this,"defaultValues",e)}},{key:"hash",get:function(){return A(this,"hash",this.hashFunction(JSON.stringify(this.jsonSchema)))}}])}();function ma(t,n,r=!0){r&&At("preCreateRxSchema",t);var o=W(t);o=function(e){return R(e,!0)}(o),e.deepFreezeWhenDevMode(o);var i=new fa(o,n);return At("createRxSchema",i),i}var pa="collection",va="storage-token",ya=W({version:0,title:"RxInternalDocument",primaryKey:{key:"id",fields:["context","key"],separator:"|"},type:"object",properties:{id:{type:"string",maxLength:200},key:{type:"string"},context:{type:"string",enum:[pa,va,"rx-migration-status","OTHER"]},data:{type:"object",additionalProperties:!0}},indexes:[],required:["key","context","data"],additionalProperties:!1,sharding:{shards:1,mode:"collection"}});function ga(e,t){return Q(ya,{key:e,context:t})}async function ba(e){var t=pi(e.schema,{selector:{context:pa,_deleted:{$eq:!1}},sort:[{id:"asc"}],skip:0});return(await e.query(t)).documents}var wa="storageToken",_a=ga(wa,va);function xa(e,t){return e+"-"+t.version}function ka(e,t){return t=function(e,t){for(var n=Object.keys(e.defaultValues),r=0;r<n.length;++r){var o=n[r];Object.prototype.hasOwnProperty.call(t,o)&&void 0!==t[o]||(t[o]=e.defaultValues[o])}return t}(e,t=C(t)),"string"!=typeof e.jsonSchema.primaryKey&&(t=function(e,t,n){if("string"==typeof t.primaryKey)return n;var r=Q(t,n),o=n[e];if(o&&o!==r)throw p("DOC19",{args:{documentData:n,existingPrimary:o,newPrimary:r},schema:t});return n[e]=r,n}(e.primaryPath,e.jsonSchema,t)),t._meta=F(),Object.prototype.hasOwnProperty.call(t,"_deleted")||(t._deleted=!1),Object.prototype.hasOwnProperty.call(t,"_attachments")||(t._attachments={}),Object.prototype.hasOwnProperty.call(t,"_rev")||(t._rev=""),t}async function Sa(t,n,r,o,i,s,a){var c=(await ba(n)).filter((e=>e.data.name===i)),u=[];c.forEach((e=>{u.push({collectionName:e.data.name,schema:e.data.schema,isCollection:!0}),e.data.connectedStorages.forEach((e=>u.push({collectionName:e.collectionName,isCollection:!1,schema:e.schema})))}));var l=new Set;if(u=u.filter((e=>{var t=e.collectionName+"||"+e.schema.version;return!l.has(t)&&(l.add(t),!0)})),await Promise.all(u.map((async n=>{var a=await t.createStorageInstance({collectionName:n.collectionName,databaseInstanceToken:r,databaseName:o,multiInstance:!1,options:{},schema:n.schema,password:s,devMode:e.isDevMode()});await a.remove(),n.isCollection&&await Nt("postRemoveRxCollection",{storage:t,databaseName:o,collectionName:i})}))),a){var h=c.map((e=>{var t=_i(e);return t._deleted=!0,t._meta.lwt=J(),t._rev=Z(r,e),{previous:e,document:t}}));await n.bulkWrite(h,"rx-database-remove-collection-all")}}function Ia(e){if(e.destroyed)throw p("COL21",{collection:e.name,version:e.schema.version})}var Ea=function(){function e(e){this.subs=[],this.counter=0,this.eventCounterMap=new WeakMap,this.buffer=[],this.limit=100,this.tasks=new Set,this.collection=e,this.subs.push(this.collection.database.eventBulks$.pipe(yt((e=>e.collectionName===this.collection.name)),yt((e=>!e.events[0].isLocal))).subscribe((e=>{this.tasks.add((()=>this._handleChangeEvents(e.events))),this.tasks.size<=1&&jt().then((()=>{this.processTasks()}))})))}var t=e.prototype;return t.processTasks=function(){0!==this.tasks.size&&(Array.from(this.tasks).forEach((e=>e())),this.tasks.clear())},t._handleChangeEvents=function(e){var t=this.counter;this.counter=this.counter+e.length,e.length>this.limit?this.buffer=e.slice(-1*e.length):(q(this.buffer,e),this.buffer=this.buffer.slice(-1*this.limit));for(var n=t+1,r=this.eventCounterMap,o=0;o<e.length;o++){var i=e[o];r.set(i,n+o)}},t.getCounter=function(){return this.processTasks(),this.counter},t.getBuffer=function(){return this.processTasks(),this.buffer},t.getArrayIndexByPointer=function(e){this.processTasks();var t=this.buffer[0],n=this.eventCounterMap.get(t);return e<n?null:e-n},t.getFrom=function(e){this.processTasks();var t=[],n=this.getArrayIndexByPointer(e);if(null===n)return null;for(;;){var r=this.buffer[n];if(n++,!r)return t;t.push(r)}},t.runFrom=function(e,t){this.processTasks();var n=this.getFrom(e);if(null===n)throw new Error("out of bounds");n.forEach((e=>t(e)))},t.reduceByLastOfDoc=function(e){return this.processTasks(),e.slice(0)},t.destroy=function(){this.tasks.clear(),this.subs.forEach((e=>e.unsubscribe()))},e}(),Oa=function(){function e(e,t,n,r){this.queueByDocId=new Map,this.isRunning=!1,this.storageInstance=e,this.primaryPath=t,this.preWrite=n,this.postWrite=r}var t=e.prototype;return t.addWrite=function(e,t){var n=e[this.primaryPath],r=_n(this.queueByDocId,n,(()=>[]));return new Promise(((n,o)=>{var i={lastKnownDocumentState:e,modifier:t,resolve:n,reject:o};G(r).push(i),this.triggerRun()}))},t.triggerRun=async function(){if(!0!==this.isRunning&&0!==this.queueByDocId.size){this.isRunning=!0;var e=[],t=this.queueByDocId;this.queueByDocId=new Map,await Promise.all(Array.from(t.entries()).map((async([t,n])=>{var r,o,i,s=(r=n.map((e=>e.lastKnownDocumentState)),o=r[0],i=X(o._rev),r.forEach((e=>{var t=X(e._rev);t>i&&(o=e,i=t)})),o),a=s;for(var c of n)try{a=await c.modifier(M(a))}catch(e){c.reject(e),c.reject=()=>{},c.resolve=()=>{}}try{await this.preWrite(a,s)}catch(e){return void n.forEach((t=>t.reject(e)))}e.push({previous:s,document:a})})));var n=e.length>0?await this.storageInstance.bulkWrite(e,"incremental-write"):{error:[]};return await Promise.all(Ii(this.primaryPath,e,n).map((e=>{var n=e[this.primaryPath];this.postWrite(e),wn(t,n).forEach((t=>t.resolve(e)))}))),n.error.forEach((e=>{var n,r=e.documentId,o=wn(t,r),i=y(e);if(i){var s=_n(this.queueByDocId,r,(()=>[]));o.reverse().forEach((e=>{e.lastKnownDocumentState=G(i.documentInDb),G(s).unshift(e)}))}else{var a=p("COL20",{name:g[(n=e).status],document:n.documentId,writeError:n});o.forEach((e=>e.reject(a)))}})),this.isRunning=!1,this.triggerRun()}},e}();function Da(e){return async t=>{var n=function(e){return Object.assign({},e,{_meta:void 0,_deleted:void 0,_rev:void 0})}(t);n._deleted=t._deleted;var r=await e(n),o=Object.assign({},r,{_meta:t._meta,_attachments:t._attachments,_rev:t._rev,_deleted:void 0!==r._deleted?r._deleted:t._deleted});return void 0===o._deleted&&(o._deleted=!1),o}}var Pa={get primaryPath(){if(this.isInstanceOfRxDocument)return this.collection.schema.primaryPath},get primary(){var e=this;if(e.isInstanceOfRxDocument)return e._data[e.primaryPath]},get revision(){if(this.isInstanceOfRxDocument)return this._data._rev},get deleted$(){if(this.isInstanceOfRxDocument)return this.$.pipe(Ue((e=>e._data._deleted)))},get deleted$$(){var e=this;return e.collection.database.getReactivityFactory().fromObservable(e.deleted$,e.getLatest().deleted,e.collection.database)},get deleted(){if(this.isInstanceOfRxDocument)return this._data._deleted},getLatest(){var e=this.collection._docCache.getLatestDocumentData(this.primary);return this.collection._docCache.getCachedRxDocument(e)},get $(){return this.collection.$.pipe(yt((e=>!e.isLocal)),yt((e=>e.documentId===this.primary)),Ue((e=>{return(t=e).documentData?t.documentData:t.previousDocumentData;var t})),bt(this.collection._docCache.getLatestDocumentData(this.primary)),St(((e,t)=>e._rev===t._rev)),Ue((e=>this.collection._docCache.getCachedRxDocument(e))),kt(Y))},get $$(){var e=this;return e.collection.database.getReactivityFactory().fromObservable(e.$,e.getLatest()._data,e.collection.database)},get$(t){if(e.isDevMode()){if(t.includes(".item."))throw p("DOC1",{path:t});if(t===this.primaryPath)throw p("DOC2");if(this.collection.schema.finalFields.includes(t))throw p("DOC3",{path:t});if(!K(this.collection.schema.jsonSchema,t))throw p("DOC4",{path:t})}return this.$.pipe(Ue((e=>P(e,t))),St())},get$$(e){var t=this.get$(e);return this.collection.database.getReactivityFactory().fromObservable(t,this.getLatest().get(e),this.collection.database)},populate(e){var t=K(this.collection.schema.jsonSchema,e),n=this.get(e);if(!n)return Dt;if(!t)throw p("DOC5",{path:e});if(!t.ref)throw p("DOC6",{path:e,schemaObj:t});var r=this.collection.database.collections[t.ref];if(!r)throw p("DOC7",{ref:t.ref,path:e,schemaObj:t});return"array"===t.type?r.findByIds(n).exec().then((e=>{var t=e.values();return Array.from(t)})):r.findOne(n).exec()},get(t){return _n(this._propertyCache,t,(()=>{var n=P(this._data,t);if("object"!=typeof n||null===n||Array.isArray(n))return e.deepFreezeWhenDevMode(n);var r=this,o=new Proxy(C(n),{get(e,n){if("string"!=typeof n)return e[n];var o=n.charAt(n.length-1);if(n.endsWith("$$")){var i=n.slice(0,-2);return r.get$$(k(t+"."+i))}if("$"===o){var s=n.slice(0,-1);return r.get$(k(t+"."+s))}if("_"===o){var a=n.slice(0,-1);return r.populate(k(t+"."+a))}return r.get(k(t+"."+n))}});return o}))},toJSON(t=!1){if(t)return e.deepFreezeWhenDevMode(this._data);var n=C(this._data);return delete n._rev,delete n._attachments,delete n._deleted,delete n._meta,e.deepFreezeWhenDevMode(n)},toMutableJSON(e=!1){return M(this.toJSON(e))},update(e){throw Rt("update")},incrementalUpdate(e){throw Rt("update")},updateCRDT(e){throw Rt("crdt")},putAttachment(){throw Rt("attachments")},getAttachment(){throw Rt("attachments")},allAttachments(){throw Rt("attachments")},get allAttachments$(){throw Rt("attachments")},async modify(e,t){var n=this._data,r=await Da(e)(n);return this._saveData(r,n)},incrementalModify(e,t){return this.collection.incrementalWriteQueue.addWrite(this._data,Da(e)).then((e=>this.collection._docCache.getCachedRxDocument(e)))},patch(e){var t=this._data,n=M(t);return Object.entries(e).forEach((([e,t])=>{n[e]=t})),this._saveData(n,t)},incrementalPatch(e){return this.incrementalModify((t=>(Object.entries(e).forEach((([e,n])=>{t[e]=n})),t)))},async _saveData(e,t){if(e=C(e),this._data._deleted)throw p("DOC11",{id:this.primary,document:this});await ja(this.collection,e,t);var n=[{previous:t,document:e}],r=await this.collection.storageInstance.bulkWrite(n,"rx-document-save-data"),o=r.error[0];return gi(this.collection,this.primary,e,o),await this.collection._runHooks("post","save",e,this),this.collection._docCache.getCachedRxDocument(Ii(this.collection.schema.primaryPath,n,r)[0])},remove(){var e=this.collection;if(this.deleted)return Promise.reject(p("DOC13",{document:this,id:this.primary}));var t,n=C(this._data);return e._runHooks("pre","remove",n,this).then((async()=>{n._deleted=!0;var t=[{previous:this._data,document:n}],r=await e.storageInstance.bulkWrite(t,"rx-document-remove"),o=r.error[0];return gi(e,this.primary,n,o),Ii(this.collection.schema.primaryPath,t,r)[0]})).then((e=>(t=e,this.collection._runHooks("post","remove",n,this)))).then((()=>this.collection._docCache.getCachedRxDocument(t)))},incrementalRemove(){return this.incrementalModify((async e=>(await this.collection._runHooks("pre","remove",e,this),e._deleted=!0,e))).then((async e=>(await this.collection._runHooks("post","remove",e._data,e),e)))},destroy(){throw p("DOC14")}};function ja(t,n,r){return n._meta=Object.assign({},r._meta,n._meta),e.isDevMode()&&t.schema.validateChange(r,n),t._runHooks("pre","save",n,r)}var Ca=new WeakMap;function Ra(e){var t=e.schema.getDocumentPrototype(),n=function(e){var t={};return Object.entries(e.methods).forEach((([e,n])=>{t[e]=n})),t}(e),r={};return[t,n,Pa].forEach((e=>{Object.getOwnPropertyNames(e).forEach((t=>{var n=Object.getOwnPropertyDescriptor(e,t),o=!0;(t.startsWith("_")||t.endsWith("_")||t.startsWith("$")||t.endsWith("$"))&&(o=!1),"function"==typeof n.value?Object.defineProperty(r,t,{get(){return n.value.bind(this)},enumerable:o,configurable:!1}):(n.enumerable=o,n.configurable=!1,n.writable&&(n.writable=!1),Object.defineProperty(r,t,n))}))})),r}function Ma(e){return _n(Ca,e,(()=>function(e=Pa){var t=function(e,t){this.collection=e,this._data=t,this._propertyCache=new Map,this.isInstanceOfRxDocument=!0};return t.prototype=e,t}(Ra(e))))}function Aa(t,n,r){var o=function(e,t,n){var r=new e(t,n);return At("createRxDocument",r),r}(n,t,e.deepFreezeWhenDevMode(r));return t._runHooksSync("post","create",r,o),At("postCreateRxDocument",o),o}var Na=function(e,t){return Gs(wi(e.newDocumentState),wi(e.realMasterState))?Promise.resolve({isEqual:!0}):Promise.resolve({isEqual:!1,documentData:e.realMasterState})},$a=["pre","post"],Ba=["insert","save","remove","create"],Ta=!1,qa=function(){function t(e,t,n,r,o={},i={},s={},a={},c={},u=ni,l={},h=Na){this.storageInstance={},this.timeouts=new Set,this.incrementalWriteQueue={},this._incrementalUpsertQueues=new Map,this.synced=!1,this.hooks={},this._subs=[],this._docCache={},this._queryCache=new Yo,this.$={},this.checkpoint$={},this._changeEventBuffer={},this.onDestroy=[],this.destroyed=!1,this.onRemove=[],this.database=e,this.name=t,this.schema=n,this.internalStorageInstance=r,this.instanceCreationOptions=o,this.migrationStrategies=i,this.methods=s,this.attachments=a,this.options=c,this.cacheReplacementPolicy=u,this.statics=l,this.conflictHandler=h,function(e){if(!Ta){Ta=!0;var t=Object.getPrototypeOf(e);Ba.forEach((e=>{$a.map((n=>{var r=n+x(e);t[r]=function(t,r){return this.addHook(n,e,t,r)}}))}))}}(this.asRxCollection)}var n=t.prototype;return n.prepare=async function(){this.storageInstance=ki(this.database,this.internalStorageInstance,this.schema.jsonSchema),this.incrementalWriteQueue=new Oa(this.storageInstance,this.schema.primaryPath,((e,t)=>ja(this,e,t)),(e=>this._runHooks("post","save",e)));var t,n,r=this.database.eventBulks$.pipe(yt((e=>e.collectionName===this.name)));this.$=r.pipe(st((e=>e.events))),this.checkpoint$=r.pipe(Ue((e=>e.checkpoint))),this._changeEventBuffer=(t=this.asRxCollection,new Ea(t)),this._docCache=new ii(this.schema.primaryPath,this.database.eventBulks$.pipe(yt((e=>e.collectionName===this.name&&!e.events[0].isLocal)),Ue((e=>e.events))),(e=>(n||(n=Ma(this.asRxCollection)),Aa(this.asRxCollection,n,e))));var o=this.database.internalStore.changeStream().pipe(yt((e=>{var t=this.name+"-"+this.schema.version;return!!e.events.find((e=>"collection"===e.documentData.context&&e.documentData.key===t&&"DELETE"===e.operation))}))).subscribe((async()=>{await this.destroy(),await Promise.all(this.onRemove.map((e=>e())))}));this._subs.push(o);var i=await this.database.storageToken,s=this.storageInstance.changeStream().subscribe((t=>{for(var n=new Array(t.events.length),r=t.events,o=this.name,s=e.deepFreezeWhenDevMode,a=0;a<r.length;a++){var c=r[a];n[a]={documentId:c.documentId,collectionName:o,isLocal:!1,operation:c.operation,documentData:s(c.documentData),previousDocumentData:s(c.previousDocumentData)}}var u={id:t.id,internal:!1,collectionName:this.name,storageToken:i,events:n,databaseToken:this.database.token,checkpoint:t.checkpoint,context:t.context,endTime:t.endTime,startTime:t.startTime};this.database.$emit(u)}));return this._subs.push(s),this._subs.push(this.storageInstance.conflictResultionTasks().subscribe((e=>{this.conflictHandler(e.input,e.context).then((t=>{this.storageInstance.resolveConflictResultionTask({id:e.id,output:t})}))}))),Pt},n.cleanup=function(e){throw Ia(this),Rt("cleanup")},n.migrationNeeded=function(){throw Rt("migration-schema")},n.getMigrationState=function(){throw Rt("migration-schema")},n.startMigration=function(e=10){return Ia(this),this.getMigrationState().startMigration(e)},n.migratePromise=function(e=10){return this.getMigrationState().migratePromise(e)},n.insert=async function(e){Ia(this);var t=await this.bulkInsert([e]),n=t.error[0];return gi(this,e[this.schema.primaryPath],e,n),G(t.success[0])},n.bulkInsert=async function(e){if(Ia(this),0===e.length)return{success:[],error:[]};var t,n=this.schema.primaryPath;if(this.hasHooks("pre","insert"))t=await Promise.all(e.map((e=>{var t=ka(this.schema,e);return this._runHooks("pre","insert",t).then((()=>({document:t})))})));else{t=new Array(e.length);for(var r=this.schema,o=0;o<e.length;o++){var i=ka(r,e[o]);t[o]={document:i}}}var s,a=await this.storageInstance.bulkWrite(t,"rx-collection-bulk-insert"),c=this,u={get success(){if(!s){var e=Ii(c.schema.primaryPath,t,a);s=ai(c._docCache,e)}return s},error:a.error};if(this.hasHooks("post","insert")){var l=new Map;t.forEach((e=>{var t=e.document;l.set(t[n],t)})),await Promise.all(u.success.map((e=>this._runHooks("post","insert",l.get(e.primary),e))))}return u},n.bulkRemove=async function(e){Ia(this);var t=this.schema.primaryPath;if(0===e.length)return{success:[],error:[]};var n=await this.findByIds(e).exec(),r=[],o=new Map;Array.from(n.values()).forEach((e=>{var t=e.toMutableJSON(!0);r.push(t),o.set(e.primary,t)})),await Promise.all(r.map((e=>{var t=e[this.schema.primaryPath];return this._runHooks("pre","remove",e,n.get(t))})));var i=r.map((e=>{var t=C(e);return t._deleted=!0,{previous:e,document:t}})),s=await this.storageInstance.bulkWrite(i,"rx-collection-bulk-remove"),a=Ii(this.schema.primaryPath,i,s).map((e=>e[t]));return await Promise.all(a.map((e=>this._runHooks("post","remove",o.get(e),n.get(e))))),{success:a.map((e=>wn(n,e))),error:s.error}},n.bulkUpsert=async function(e){Ia(this);var t=[],n=new Map;e.forEach((e=>{var r=ka(this.schema,e),o=r[this.schema.primaryPath];if(!o)throw p("COL3",{primaryPath:this.schema.primaryPath,data:r,schema:this.schema.jsonSchema});n.set(o,r),t.push(r)}));var r=await this.bulkInsert(t),o=r.success.slice(0),i=[];return await Promise.all(r.error.map((async e=>{if(409!==e.status)i.push(e);else{var t=e.documentId,r=wn(n,t),s=G(e.documentInDb),a=this._docCache.getCachedRxDocuments([s])[0],c=await a.incrementalModify((()=>r));o.push(c)}}))),{error:i,success:o}},n.upsert=async function(e){Ia(this);var t=await this.bulkUpsert([e]);return gi(this.asRxCollection,e[this.schema.primaryPath],e,t.error[0]),t.success[0]},n.incrementalUpsert=function(e){Ia(this);var t=ka(this.schema,e),n=t[this.schema.primaryPath];if(!n)throw p("COL4",{data:e});var r=this._incrementalUpsertQueues.get(n);return r||(r=Pt),r=r.then((()=>function(e,t,n){var r=e._docCache.getLatestDocumentDataIfExists(t);return r?Promise.resolve({doc:e._docCache.getCachedRxDocuments([r])[0],inserted:!1}):e.findOne(t).exec().then((t=>t?{doc:t,inserted:!1}:e.insert(n).then((e=>({doc:e,inserted:!0})))))}(this,n,t))).then((e=>e.inserted?e.doc:function(e,t){return e.incrementalModify((e=>t))}(e.doc,t))),this._incrementalUpsertQueues.set(n,r),r},n.find=function(e){if(Ia(this),"string"==typeof e)throw p("COL5",{queryObj:e});return e||(e={selector:{}}),di("find",e,this)},n.findOne=function(e){if(Ia(this),"number"==typeof e||Array.isArray(e))throw v("COL6",{queryObj:e});var t;if("string"==typeof e)t=di("findOne",{selector:{[this.schema.primaryPath]:e},limit:1},this);else{if(e||(e={selector:{}}),e.limit)throw p("QU6");(e=C(e)).limit=1,t=di("findOne",e,this)}return t},n.count=function(e){return Ia(this),e||(e={selector:{}}),di("count",e,this)},n.findByIds=function(e){return Ia(this),di("findByIds",{selector:{[this.schema.primaryPath]:{$in:e.slice(0)}}},this)},n.exportJSON=function(){throw Rt("json-dump")},n.importJSON=function(e){throw Rt("json-dump")},n.insertCRDT=function(e){throw Rt("crdt")},n.addHook=function(e,t,n,r=!1){if("function"!=typeof n)throw v("COL7",{key:t,when:e});if(!$a.includes(e))throw v("COL8",{key:t,when:e});if(!Ba.includes(t))throw p("COL9",{key:t});if("post"===e&&"create"===t&&!0===r)throw p("COL10",{when:e,key:t,parallel:r});var o=n.bind(this),i=r?"parallel":"series";this.hooks[t]=this.hooks[t]||{},this.hooks[t][e]=this.hooks[t][e]||{series:[],parallel:[]},this.hooks[t][e][i].push(o)},n.getHooks=function(e,t){return this.hooks[t]&&this.hooks[t][e]?this.hooks[t][e]:{series:[],parallel:[]}},n.hasHooks=function(e,t){if(!this.hooks[t]||!this.hooks[t][e])return!1;var n=this.getHooks(e,t);return!!n&&(n.series.length>0||n.parallel.length>0)},n._runHooks=function(e,t,n,r){var o=this.getHooks(e,t);return o?function(e,t){return e.reduce(((e,t)=>e.then(t)),Promise.resolve(t))}(o.series.map((e=>()=>e(n,r)))).then((()=>Promise.all(o.parallel.map((e=>e(n,r)))))):Pt},n._runHooksSync=function(e,t,n,r){if(this.hasHooks(e,t)){var o=this.getHooks(e,t);o&&o.series.forEach((e=>e(n,r)))}},n.promiseWait=function(e){return new Promise((t=>{var n=setTimeout((()=>{this.timeouts.delete(n),t()}),e);this.timeouts.add(n)}))},n.destroy=async function(){return this.destroyed?Ot:(await Promise.all(this.onDestroy.map((e=>e()))),this.destroyed=!0,Array.from(this.timeouts).forEach((e=>clearTimeout(e))),this._changeEventBuffer&&this._changeEventBuffer.destroy(),this.database.requestIdlePromise().then((()=>this.storageInstance.close())).then((()=>(this._subs.forEach((e=>e.unsubscribe())),delete this.database.collections[this.name],Nt("postDestroyRxCollection",this).then((()=>!0))))))},n.remove=async function(){await this.destroy(),await Promise.all(this.onRemove.map((e=>e()))),await Sa(this.database.storage,this.database.internalStore,this.database.token,this.database.name,this.name,this.database.password,this.database.hashFunction)},o(t,[{key:"insert$",get:function(){return this.$.pipe(yt((e=>"INSERT"===e.operation)))}},{key:"update$",get:function(){return this.$.pipe(yt((e=>"UPDATE"===e.operation)))}},{key:"remove$",get:function(){return this.$.pipe(yt((e=>"DELETE"===e.operation)))}},{key:"asRxCollection",get:function(){return this}}])}(),La=new Set,Fa=function(){function t(e,t,n,r,o,i,s=!1,a={},c,u,l,h,d){this.idleQueue=new Zs,this.rxdbVersion=Ei,this.storageInstances=new Set,this._subs=[],this.startupErrors=[],this.onDestroy=[],this.destroyed=!1,this.collections={},this.states={},this.eventBulks$=new Le,this.observable$=this.eventBulks$.pipe(st((e=>e.events))),this.storageToken=Ot,this.storageTokenDocument=Ot,this.emittedEventBulkIds=new ds(6e4),this.name=e,this.token=t,this.storage=n,this.instanceCreationOptions=r,this.password=o,this.multiInstance=i,this.eventReduce=s,this.options=a,this.internalStore=c,this.hashFunction=u,this.cleanupPolicy=l,this.allowSlowCount=h,this.reactivity=d,"pseudoInstance"!==this.name&&(this.internalStore=ki(this.asRxDatabase,c,ya),this.storageTokenDocument=async function(e){var t=_(10),n=e.password?await e.hashFunction(JSON.stringify(e.password)):void 0,r=[{document:{id:_a,context:va,key:wa,data:{rxdbVersion:e.rxdbVersion,token:t,instanceToken:e.token,passwordHash:n},_deleted:!1,_meta:F(),_rev:"",_attachments:{}}}],o=await e.internalStore.bulkWrite(r,"internal-add-storage-token");if(!o.error[0])return Ii("id",r,o)[0];var i,s,a=G(o.error[0]);if(a.isError&&y(a)){var c=a;if(i=c.documentInDb.data.rxdbVersion,s=e.rxdbVersion,!i||s.includes("beta")&&s!==i||i.split(".")[0]!==s.split(".")[0])throw p("DM5",{args:{database:e.name,databaseStateVersion:c.documentInDb.data.rxdbVersion,codeVersion:e.rxdbVersion}});if(n&&n!==c.documentInDb.data.passwordHash)throw p("DB1",{passwordHash:n,existingPasswordHash:c.documentInDb.data.passwordHash});return G(c.documentInDb)}throw a}(this.asRxDatabase).catch((e=>this.startupErrors.push(e))),this.storageToken=this.storageTokenDocument.then((e=>e.data.token)).catch((e=>this.startupErrors.push(e))))}var n=t.prototype;return n.getReactivityFactory=function(){if(!this.reactivity)throw p("DB14",{database:this.name});return this.reactivity},n.$emit=function(e){this.emittedEventBulkIds.has(e.id)||(this.emittedEventBulkIds.add(e.id),this.eventBulks$.next(e))},n.removeCollectionDoc=async function(e,t){var n=await yi(this.internalStore,ga(xa(e,t),pa));if(!n)throw p("SNH",{name:e,schema:t});var r=_i(n);r._deleted=!0,await this.internalStore.bulkWrite([{document:r,previous:n}],"rx-database-remove-collection")},n.addCollections=async function(t){var n={},r={},o=[],i={};await Promise.all(Object.entries(t).map((async([e,t])=>{var s=e,a=t.schema;n[s]=a;var c=ma(a,this.hashFunction);if(r[s]=c,this.collections[e])throw p("DB3",{name:e});var u=xa(e,a),l={id:ga(u,pa),key:u,context:pa,data:{name:s,schemaHash:await c.hash,schema:c.jsonSchema,version:c.version,connectedStorages:[]},_deleted:!1,_meta:F(),_rev:"",_attachments:{}};o.push({document:l});var h=Object.assign({},t,{name:s,schema:c,database:this}),d=C(t);d.database=this,d.name=e,At("preCreateRxCollection",d),h.conflictHandler=d.conflictHandler,i[s]=h})));var s=await this.internalStore.bulkWrite(o,"rx-database-add-collection");await async function(e){if(await e.storageToken,e.startupErrors[0])throw e.startupErrors[0]}(this),await Promise.all(s.error.map((async e=>{if(409!==e.status)throw p("DB12",{database:this.name,writeError:e});var t=G(e.documentInDb),o=t.data.name,i=r[o];if(t.data.schemaHash!==await i.hash)throw p("DB6",{database:this.name,collection:o,previousSchemaHash:t.data.schemaHash,schemaHash:await i.hash,previousSchema:t.data.schema,schema:G(n[o])})})));var a={};return await Promise.all(Object.keys(t).map((async t=>{var n=i[t],r=await function({database:t,name:n,schema:r,instanceCreationOptions:o={},migrationStrategies:i={},autoMigrate:s=!0,statics:a={},methods:c={},attachments:u={},options:l={},localDocuments:h=!1,cacheReplacementPolicy:d=ni,conflictHandler:f=Na}){var m={databaseInstanceToken:t.token,databaseName:t.name,collectionName:n,schema:r.jsonSchema,options:o,multiInstance:t.multiInstance,password:t.password,devMode:e.isDevMode()};return At("preCreateRxStorageInstance",m),async function(e,t){return t.multiInstance=e.multiInstance,await e.storage.createStorageInstance(t)}(t,m).then((e=>{var m=new qa(t,n,r,e,o,i,c,u,l,d,a,f);return m.prepare().then((()=>{Object.entries(a).forEach((([e,t])=>{Object.defineProperty(m,e,{get:()=>t.bind(m)})}));var e=Pt;return s&&0!==m.schema.version&&(e=m.migratePromise()),e})).then((()=>(At("createRxCollection",{collection:m,creator:{name:n,schema:r,storageInstance:e,instanceCreationOptions:o,migrationStrategies:i,methods:c,attachments:u,options:l,cacheReplacementPolicy:d,localDocuments:h,statics:a}}),m))).catch((t=>e.close().then((()=>Promise.reject(t)))))}))}(n);a[t]=r,this.collections[t]=r,this[t]||Object.defineProperty(this,t,{get:()=>this.collections[t]})}))),a},n.lockedRun=function(e){return this.idleQueue.wrapCall(e)},n.requestIdlePromise=function(){return this.idleQueue.requestIdlePromise()},n.exportJSON=function(e){throw Rt("json-dump")},n.addState=function(e){throw Rt("state")},n.importJSON=function(e){throw Rt("json-dump")},n.backup=function(e){throw Rt("backup")},n.leaderElector=function(){throw Rt("leader-election")},n.isLeader=function(){throw Rt("leader-election")},n.waitForLeadership=function(){throw Rt("leader-election")},n.migrationStates=function(){throw Rt("migration-schema")},n.destroy=async function(){return this.destroyed?Ot:(this.destroyed=!0,await Nt("preDestroyRxDatabase",this),this.eventBulks$.complete(),this._subs.map((e=>e.unsubscribe())),"pseudoInstance"===this.name?Ot:this.requestIdlePromise().then((()=>Promise.all(this.onDestroy.map((e=>e()))))).then((()=>Promise.all(Object.keys(this.collections).map((e=>this.collections[e])).map((e=>e.destroy()))))).then((()=>this.internalStore.close())).then((()=>La.delete(this.storage.name+"|"+this.name))).then((()=>!0)))},n.remove=function(){return this.destroy().then((()=>async function(e,t,n){var r=_(10),o=await Ka(r,t,e,{},!1,n),i=await ba(o),s=new Set;i.forEach((e=>s.add(e.data.name)));var a=Array.from(s);return await Promise.all(a.map((i=>Sa(t,o,r,e,i,n)))),await Nt("postRemoveRxDatabase",{databaseName:e,storage:t}),await o.remove(),a}(this.name,this.storage,this.password)))},o(t,[{key:"$",get:function(){return this.observable$}},{key:"asRxDatabase",get:function(){return this}}])}();async function Ka(t,n,r,o,i,s){return await n.createStorageInstance({databaseInstanceToken:t,databaseName:r,collectionName:vi,schema:ya,options:o,multiInstance:i,password:s,devMode:e.isDevMode()})}function za({storage:e,instanceCreationOptions:t,name:n,password:r,multiInstance:o=!0,eventReduce:i=!0,ignoreDuplicate:s=!1,options:a={},cleanupPolicy:c,allowSlowCount:u=!1,localDocuments:l=!1,hashFunction:h=da,reactivity:d}){At("preCreateRxDatabase",{storage:e,instanceCreationOptions:t,name:n,password:r,multiInstance:o,eventReduce:i,ignoreDuplicate:s,options:a,localDocuments:l}),s||function(e,t){var n=t.name+"|"+e;if(La.has(n))throw p("DB8",{name:e,storage:t.name,link:"https://rxdb.info/rx-database.html#ignoreduplicate"})}(n,e),La.add(e.name+"|"+n);var f=_(10);return Ka(f,e,n,t,o,r).catch((t=>{throw La.delete(e.name+"|"+n),t})).then((m=>{var p=new Fa(n,f,e,t,r,o,i,a,m,h,c,u,d);return Nt("createRxDatabase",{database:p,creator:{storage:e,instanceCreationOptions:t,name:n,password:r,multiInstance:o,eventReduce:i,ignoreDuplicate:s,options:a,localDocuments:l}}).then((()=>p))}))}var Qa=function(e={}){var t=e.IDBKeyRange?e.IDBKeyRange:IDBKeyRange,n=e.indexedDB?e.indexedDB:indexedDB,r=Object.assign({batchSize:300,transactionDurability:"relaxed"},e,{IDBKeyRange:t,indexedDB:n});return new Js(r)}({});!function(e){var t;console.log("exposeWorkerRxStorage()");var n=new Le;if("undefined"!=typeof self&&"object"==typeof self.onconnect){var r=new Map;self.onconnect=e=>{var t=e.ports[0];t.onmessage=e=>{var o=e.data;r.set(o.connectionId,t),n.next(o)}},t={storage:e.storage,messages$:n,send(e){wn(r,e.connectionId).postMessage(e)}}}else addEventListener("message",(e=>{var t=e.data;n.next(t)})),t={storage:e.storage,messages$:n,send(e){self.postMessage(e)}};!function(e){var t=new Map;function n(t){if(e.storage)return e.storage.createStorageInstance(t);if(e.database){var n=Array.from(e.database.storageInstances),r=t.collectionName,o=n.find((e=>e.collectionName===r));if(!o)throw console.dir(n),new Error("storageInstance does not exist "+JSON.stringify({collectionName:r}));var i=t.schema;if(!Gs(i,o.schema))throw new Error("Wrong schema "+JSON.stringify({schema:i,existingSchema:o.schema}));return Promise.resolve(o)}throw new Error("no base given")}e.messages$.pipe(yt((e=>"custom"===e.method))).subscribe((async t=>{if(e.customRequestHandler)try{var n=await e.customRequestHandler(t.params);e.send(Xs(t,n))}catch(n){e.send(Ys(t,n))}else e.send(Ys(t,new Error("Remote storage: cannot resolve custom request because settings.customRequestHandler is not set")))})),e.messages$.pipe(yt((e=>"create"===e.method))).subscribe((async r=>{var o=r.connectionId;if(!Array.isArray(r.params)){var i=r.params,s=i.collectionName,a=[i.databaseName,i.collectionName,i.schema.version].join("|"),c=t.get(a);if(c){if(!Gs(i.schema,c.params.schema))return void e.send(Ys(r,new Error("Remote storage: schema not equal to existing storage")))}else try{c={storageInstancePromise:n(i),connectionIds:new Set,params:i},t.set(a,c),await c.storageInstancePromise}catch(t){return void e.send(Ys(r,t))}c.connectionIds.add(r.connectionId);var u=[],l=await c.storageInstancePromise;u.push(l.changeStream().subscribe((t=>{var n={connectionId:o,answerTo:"changestream",method:"changeStream",return:t};e.send(n)}))),u.push(l.conflictResultionTasks().subscribe((t=>{var n={connectionId:o,answerTo:"conflictResultionTasks",method:"conflictResultionTasks",return:t};e.send(n)})));var h=!1;if(e.database){var d=e.database,f=d.collections[s];f?f.onDestroy.push((()=>m())):d.onDestroy.push((()=>m()))}u.push(e.messages$.pipe(yt((e=>e.connectionId===o))).subscribe((async t=>{var n,r=t;if("create"!==r.method&&"custom"!==r.method&&Array.isArray(r.params))try{if("close"===r.method&&e.database)return void e.send(Xs(r,null));if("close"===r.method&&G(c).connectionIds.size>1)return e.send(Xs(r,null)),G(c).connectionIds.delete(o),void u.forEach((e=>e.unsubscribe()));n="getChangedDocumentsSince"!==r.method||l.getChangedDocumentsSince?await l[r.method](r.params[0],r.params[1],r.params[2],r.params[3]):await Si(l,r.params[0],r.params[1]),"close"!==r.method&&"remove"!==r.method||m(),e.send(Xs(r,n))}catch(t){e.send(Ys(r,t))}}))),e.send(Xs(r,"ok"))}function m(){h||(h=!0,u.forEach((e=>e.unsubscribe())),G(c).connectionIds.delete(o),t.delete(a))}}))}(t)}({storage:Qa}),async function(){console.log("w: create 1"),await za({name:"test",storage:Qa}),console.log("w: create 2")}()})();