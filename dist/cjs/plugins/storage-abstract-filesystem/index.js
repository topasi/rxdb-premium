Object.defineProperty(exports,"__esModule",{value:!0}),exports.RxStorageAbstractFilesystem=void 0,exports.getRxStorageAbstractFilesystem=o;var e=require("rxdb/plugins/core"),r=require("../../plugins/shared/version-check.js"),t=require("./storage-instance.js"),s=require("rxjs"),i=require("../shared/rxdb-premium-version.js"),a=require("./helpers.js"),n=exports.RxStorageAbstractFilesystem=function(){function a(e,r,t,s,a){this.rxdbVersion=i.RXDB_PREMIUM_VERSION,this.name=e,this.abstractFilesystem=r,this.abstractLock=t,this.inWorker=s,this.jsonPositionSize=a}return a.prototype.createStorageInstance=async function(i){(0,e.ensureRxStorageInstanceParamsAreCorrect)(i),(0,r.checkVersion)();var a=await(0,t.createAbstractFilesystemStorageInstance)(this,i,{});if(!this.inWorker){["findDocumentsById","query","bulkWrite"].forEach((e=>{var r=a[e].bind(a);a[e]=async(e,t,s,i,a)=>{var n=await r(e,t,s,i,a);return"string"==typeof n&&(n=JSON.parse(n)),n}}));var n=a.changeStream.bind(a);a.changeStream=()=>n().pipe((0,s.map)((e=>("string"==typeof e&&(e=JSON.parse(e)),e))))}return a},a}();function o(e){return new n(e.name,e.abstractFilesystem,e.abstractLock,!!e.inWorker&&e.inWorker,e.jsonPositionSize?e.jsonPositionSize:a.DEFAULT_DOC_JSON_POSITION_SIZE)}