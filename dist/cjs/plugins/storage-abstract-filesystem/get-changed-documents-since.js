Object.defineProperty(exports,"__esModule",{value:!0}),exports.getChangedDocumentsSince=i;var e=require("rxdb/plugins/core"),r=require("../storage-indexeddb/index.js"),t=require("rxdb/plugins/storage-memory"),a=require("./task-queue.js"),n=require("./documents-file.js"),s=require("./helpers.js");async function i(i,o,d,u){u||(u={id:"",lwt:0});var c=await i.internals.statePromise,l=["_meta.lwt",i.primaryPath],m=(0,r.getIndexName)(l),w=(0,e.ensureNotFalsy)(c.indexStates.find((e=>e.name===m)));if(0===w.rows.length)return{documents:[],checkpoint:u};var g=[u.lwt,u.id],p=(0,e.getStartIndexStringFromLowerBound)(i.schema,l,g),x=(0,t.boundGT)(w.rows,[p],s.compareIndexRows),h=await(0,a.getAccessHandle)(c.documentFileHandle,o),f=w.rows.slice(x,x+d),q=[];for(var v of f){var y=(await(0,n.getDocumentsJson)(c,h,o,[v]))[0];q.push(y)}var b=(0,e.lastOfArray)(q);return{documents:q,checkpoint:b?{id:b[i.primaryPath],lwt:b._meta.lwt}:u}}