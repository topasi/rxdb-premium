var e=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.getRxStorageWorker=s;var r=require("rxdb/plugins/utils"),t=require("rxdb/plugins/storage-remote"),o=require("rxjs"),n=e(require("web-worker"));function s(e){return(0,t.getRxStorageRemote)({identifier:"rx-storage-worker-"+e.workerInput,mode:e.mode,messageChannelCreator(){var t="function"==typeof e.workerInput?e.workerInput():new n.default(e.workerInput,e.workerOptions);if(!(t instanceof n.default))throw new Error("no Worker given");var s=[],a=e=>{s.push(e)};t.addEventListener("error",a);var i=new o.Subject,u=e=>{var r=e.data;i.next(r)};return t.addEventListener("message",u),Promise.resolve({messages$:i,send(e){t.postMessage(e)},close:()=>(t.removeEventListener("message",u),t.removeEventListener("error",a),r.PROMISE_RESOLVE_VOID)})}})}