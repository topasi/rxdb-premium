Object.defineProperty(exports,"__esModule",{value:!0}),exports.getRxStorageSharedWorker=o,exports.getSharedWorkerStateByInput=n;var e=require("rxdb/plugins/utils"),r=require("rxdb/plugins/storage-remote"),t=require("rxjs");function o(e){var t=n(e);return(0,r.getRxStorageRemote)(t)}function n(r){return{identifier:"shared-worker-"+r.workerInput,mode:"one",messageChannelCreator:()=>{var o="function"==typeof r.workerInput?r.workerInput():new SharedWorker(r.workerInput,r.workerOptions);if(!(o instanceof SharedWorker))throw new Error("no SharedWorker given");var n=[];o.onerror=e=>{n.push(e)};var s=new t.Subject,a=e=>{var r=e.data;s.next(r)};return o.port.addEventListener("message",a),o.port.start(),Promise.resolve({messages$:s,send(e){o.port.postMessage(e)},close:()=>(o.port.removeEventListener("message",a),e.PROMISE_RESOLVE_VOID)})}}}