Object.defineProperty(exports,"__esModule",{value:!0}),exports.MEMORY_MAPPED_SCHEMA_TITLE=exports.MEMORY_MAPPED_ID_SIZE=void 0,exports.getMemoryMappedPersistenceSchema=s,exports.getNextBlockId=i,exports.getNonCleanedUpBlocks=o;var e=require("rxdb/plugins/core"),t=exports.MEMORY_MAPPED_SCHEMA_TITLE="RxJsonSchemaMemoryMappedPersistenceBlock",r=exports.MEMORY_MAPPED_ID_SIZE=12;function s(s){var i=s.encrypted&&s.encrypted.length>0,o={title:t,primaryKey:"id",type:"object",version:s.version,keyCompression:s.keyCompression,properties:{id:{type:"string",maxLength:r,minLength:r},c:{type:"boolean"},s:{type:"array",items:{type:"string",maxLength:r,minLength:r}},d:{type:"array",minItems:1,items:{type:"object",properties:s.properties,required:s.required,additionalProperties:!1}}},required:["id","c","s","d"],encrypted:i?["d"]:void 0,indexes:[["c"]]};return i&&(o.properties.d={type:"string"}),(0,e.fillWithDefaultSettings)(o)}async function i(e){var t=await e.internals.initDonePromise,s=((t.lastBlockId?parseInt(t.lastBlockId):0)+1+"").padStart(r,"0");return t.lastBlockId=s,s}async function o(t){return(await t.query((0,e.prepareQuery)(t.schema,(0,e.normalizeMangoQuery)(t.schema,{selector:{c:{$eq:!1},_deleted:{$eq:!1}},sort:[{id:"desc"}]})))).documents}