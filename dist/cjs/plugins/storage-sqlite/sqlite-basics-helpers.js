Object.defineProperty(exports,"__esModule",{value:!0}),exports.EMPTY_FUNCTION=void 0,exports.closeSQLiteDatabaseNode=c,exports.execSqlSQLiteNode=t,exports.getSQLiteBasicsCapacitor=y,exports.getSQLiteBasicsExpoSQLite=g,exports.getSQLiteBasicsNode=s,exports.getSQLiteBasicsNodeNative=n,exports.getSQLiteBasicsQuickSQLite=m,exports.getSQLiteBasicsWasm=v,exports.getSQLiteBasicsWebSQL=w,exports.mapNodeNativeParams=o,exports.webSQLExecuteQuery=d;var e=require("rxdb/plugins/core"),r=require("./sqlite-helpers.js"),a=new WeakMap;function s(e){var r=a.get(e);return r||(r={open:r=>Promise.resolve(new e.Database(r)),async run(e,r){if(!Array.isArray(r.params))throw console.dir(r),new Error("no params array given for query: "+r.query);await t(e,r,"run")},all:async(e,r)=>await t(e,r,"all"),setPragma:async(e,r,a)=>t(e,{query:"PRAGMA "+r+" = "+a,params:[],context:{method:"setPragma",data:{key:r,value:a}}},"run"),close:e=>c(e),journalMode:"WAL2"},a.set(e,r)),r}function n(e){return{open:async r=>new e(r),all:async(e,r)=>{var a=e.prepare(r.query);return await a.all(...o(r.params))},run:async(e,r)=>{var a=e.prepare(r.query);await a.run(...o(r.params))},setPragma:async(e,r,a)=>{await e.exec("pragma "+r+" = "+a+";")},close:async e=>e.close(),journalMode:""}}function o(e){return e.map((e=>"boolean"==typeof e?e?1:0:e))}function t(e,r,a){var s=!1,n=!1;return new Promise(((o,t)=>{s&&console.log("# execSqlSQLiteNode() "+r.query),e[a](r.query,r.params,((a,c)=>{if(n)throw new Error("callback called mutliple times "+r.query);n=!0,a?(s&&(console.log("---- ERROR RUNNING SQL:"),console.log(r.query),console.dir(r.params),console.dir(a),console.log("----")),t(a)):(s&&(console.log("execSql() result: "+e.eventNames()),console.log(r.query),console.dir(c),console.log("execSql() result:"),console.log(r.query),console.dir(r.params),console.log("execSql() result -------------------------")),o(c))}))}))}function c(e){return new Promise(((r,a)=>{var s=!1;e.close((e=>{if(s)throw new Error("close() callback called mutliple times");s=!0,e&&!e.message.includes("Database is closed")?a(e):r()}))}))}var l=new WeakMap,i=new Map,u=e.PROMISE_RESOLVE_VOID;function y(r,a){return(0,e.getFromMapOrCreate)(l,r,(()=>({open:a=>u=u.then((async()=>{var s=await(0,e.getFromMapOrCreate)(i,a,(()=>r.createConnection(a,!1,"no-encryption",1)));return await s.open(),s})),async run(e,r){await e.run(r.query,r.params,!1)},async all(r,a){var s=await r.query(a.query,a.params);return(0,e.ensureNotFalsy)(s.values)},setPragma:async(e,r,a)=>e.execute("PRAGMA "+r+" = "+a,!1),close:e=>u=u.then((()=>e.close())),journalMode:"android"===a.getPlatform()?"":"WAL"})))}var p=()=>{};function m(e){return{open:async r=>e({name:r}),all:async(e,r)=>(await e.executeAsync(r.query,r.params)).rows._array,run:async(e,r)=>e.executeAsync(r.query,r.params),setPragma:async(e,r,a)=>e.executeAsync("PRAGMA "+r+" = "+a,[]),close:async e=>{e.close(p,p)},journalMode:""}}function g(e){return{open:async r=>Promise.resolve(e(r)),all:async(e,r)=>new Promise(((a,s)=>{e.exec([{sql:r.query,args:r.params}],!1,((e,r)=>{if(e)return s(e);if(Array.isArray(r)){var n=r[0];return Object.prototype.hasOwnProperty.call(n,"rows")?a(n.rows):s(n.error)}return s(new Error("getSQLiteBasicsExpoSQLite.all() response is not an array: "+r))}))})),run:async(e,r)=>new Promise(((a,s)=>{e.exec([{sql:r.query,args:r.params}],!1,((e,r)=>e?s(e):Array.isArray(r)&&r[0]&&r[0].error?s(r):void a(r)))})),setPragma:(e,r,a)=>new Promise(((s,n)=>{e.exec([{sql:"pragma "+r+" = "+a+";",args:[]}],!1,((e,r)=>e?n(e):Array.isArray(r)&&r[0]&&r[0].error?n(r):void s(r)))})),close:async e=>e.closeAsync(),journalMode:""}}function w(r){return{open:async a=>{var s=await r(a,"1.0","",1);return(0,e.ensureNotFalsy)(s._db)},all:async(e,r)=>{var a=await d(e,r);return Array.from(a.rows)},run:async(e,r)=>{await d(e,r)},setPragma:async(e,r,a)=>{await d(e,{query:"pragma "+r+" = "+a+";",params:[],context:{method:"setPragma",data:{key:r,value:a}}}).catch((e=>{if(!e.message.includes("23 not authorized"))throw e}))},close:async e=>"function"==typeof e.closeAsync?e.closeAsync():"function"==typeof e.close?e.close():void 0,journalMode:""}}function d(e,r){return new Promise(((a,s)=>{e.exec([{sql:r.query,args:r.params}],!1,((e,r)=>e?s(e):Array.isArray(r)&&r[0]&&r[0].error?s(r[0].error):a(r[0])))}))}exports.EMPTY_FUNCTION=p;var x=e.PROMISE_RESOLVE_VOID;function v(a){var s=(0,e.randomCouchString)(5);return console.log("getSQLiteBasicsWasm() debugId: "+s),{debugId:s,open:async e=>{var r=x.then((async()=>({nr:await a.open_v2(e),name:e})));return x=r.catch((()=>{})),r},all:async(e,s)=>{var n=x.then((async()=>(await a.execWithParams(e.nr,s.query,(0,r.boolParamsToInt)(s.params))).rows));return x=n.catch((()=>{})),n},run:async(e,r)=>{var s=x.then((async()=>{await a.run(e.nr,r.query,r.params)}));return x=s.catch((()=>{})),s},setPragma:async(e,r,s)=>{var n=x.then((async()=>{await a.exec(e.nr,"pragma "+r+" = "+s+";")}));return x=n.catch((()=>{})),n},close:async e=>{var r=x.then((async()=>{await a.close(e.nr)}));return x=r.catch((()=>{})),r},journalMode:""}}