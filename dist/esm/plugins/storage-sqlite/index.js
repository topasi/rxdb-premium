import{arrayBufferToBase64 as t,ensureNotFalsy as r,ensureRxStorageInstanceParamsAreCorrect as e,flatClone as s}from"rxdb/plugins/core";import{checkVersion as n}from"../../plugins/shared/version-check.js";import{RX_STORAGE_NAME_SQLITE as a}from"./sqlite-helpers.js";import{createSQLiteStorageInstance as o}from"./sqlite-storage-instance.js";import{RXDB_PREMIUM_VERSION as i}from"../shared/rxdb-premium-version.js";export*from"./sqlite-helpers.js";export*from"./sqlite-types.js";export*from"./sqlite-storage-instance.js";export*from"./sqlite-basics-helpers.js";export var RxStorageSQLite=function(){function r(t){this.name=a,this.rxdbVersion=i,this.settings=t}var s=r.prototype;return s.createStorageInstance=function(t){return e(t),n(),o(this,t,this.settings)},s.base64AttachmentToStoredAttachmentsData=function(t){return this.settings.storeAttachmentsAsBase64String?t:Buffer.from(t,"base64")},s.storedAttachmentsDataToBase64=function(r){return"string"==typeof r?r:r instanceof Uint8Array?t(r):r.toString("base64")},r}();export function getRxStorageSQLite(t){if(t.log){var e=0,n=e=>r(t.log)("## RxStorage SQLite log: "+e);t=s(t);var a=s(t.sqliteBasics),o=a.open;a.open=t=>{var r=e++;return n("open("+r+") "+t),o(t).then((t=>(n("open("+r+") DONE "),t))).catch((t=>{throw n("open("+r+") ERROR "),t}))};var i=a.all;a.all=(t,r)=>{var s=e++;return n("all("+s+") "+JSON.stringify(r)),i(t,r).then((t=>(n("all("+s+") DONE "),t))).catch((t=>{throw n("all("+s+") ERROR "),t}))};var c=a.run;a.run=(t,r)=>{var s=e++;return n("run("+s+") "+JSON.stringify(r)),c(t,r).then((t=>(n("run("+s+") DONE "),t))).catch((t=>{throw n("run("+s+") ERROR "),t}))};var h=a.setPragma;a.setPragma=(t,r,s)=>{var a=e++;return n("setPragma("+a+") "+JSON.stringify({key:r,value:s})),h(t,r,s).then((t=>(n("setPragma("+a+") DONE "),t))).catch((t=>{throw n("setPragma("+a+") ERROR "),t}))},t.sqliteBasics=a}return new RxStorageSQLite(t)}