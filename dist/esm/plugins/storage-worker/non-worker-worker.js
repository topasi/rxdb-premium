import{PROMISE_RESOLVE_VOID as e}from"rxdb/plugins/utils";import{getRxStorageRemote as r}from"rxdb/plugins/storage-remote";import{Subject as o}from"rxjs";import t from"web-worker";export function getRxStorageWorker(n){return r({identifier:"rx-storage-worker-"+n.workerInput,mode:n.mode,messageChannelCreator(){var r="function"==typeof n.workerInput?n.workerInput():new t(n.workerInput,n.workerOptions);if(!(r instanceof t))throw new Error("no Worker given");var s=[],i=e=>{s.push(e)};r.addEventListener("error",i);var a=new o,m=e=>{var r=e.data;a.next(r)};return r.addEventListener("message",m),Promise.resolve({messages$:a,send(e){r.postMessage(e)},close:()=>(r.removeEventListener("message",m),r.removeEventListener("error",i),e)})}})}