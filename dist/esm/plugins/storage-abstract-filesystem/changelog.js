import{getFromMapOrCreate as e,getPrimaryKeyFromIndexableString as t}from"rxdb/plugins/core";import{AbstractFile as n}from"./file-abstraction.js";import{INDEX_ID_LENGTH as r,INDEX_ROW_ID_LENGTH as a}from"./index-state.js";export function getChangelogFile(e,t,o){return new n(e.then((e=>e.getFileHandle("changelog.txt",{create:!0}))),0,[{type:"number",length:r},{type:"number",length:a},{type:"string",length:1},{type:"string",length:t},{type:"number",length:o},{type:"number",length:o}])}export async function getChangelogOperations(n,r,a,o=0){var i={lastRowId:o,operationsByIndexId:new Map};return await r.readRows(n,o,(n=>{i.lastRowId=i.lastRowId+1;var[r,o,p,g,l,s]=n,d=e(i.operationsByIndexId,r,(()=>[])),h=a[r],m=g.slice(0,h.indexableStringLength),y=t(m,h.primaryKeyLength).trim();d.push([r,o,p,[m,y,l,s]])})),i}export async function addChangelogOperations(e,t,n,r){var a=n.map((e=>[e[0],e[1],e[2],e[3][0].padEnd(r),e[3][2],e[3][3]]));await t.appendRows(e,a)}