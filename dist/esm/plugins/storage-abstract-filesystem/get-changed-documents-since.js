import{ensureNotFalsy as r,getStartIndexStringFromLowerBound as t,lastOfArray as e}from"rxdb/plugins/core";import{getIndexName as o}from"../storage-indexeddb/index.js";import{boundGT as i}from"rxdb/plugins/storage-memory";import{getAccessHandle as a}from"./task-queue.js";import{getDocumentsJson as m}from"./documents-file.js";import{compareIndexRows as n}from"./helpers.js";export async function getChangedDocumentsSince(s,d,c,p){p||(p={id:"",lwt:0});var l=await s.internals.statePromise,u=["_meta.lwt",s.primaryPath],f=o(u),w=r(l.indexStates.find((r=>r.name===f)));if(0===w.rows.length)return{documents:[],checkpoint:p};var h=[p.lwt,p.id],g=t(s.schema,u,h),x=i(w.rows,[g],n),v=await a(l.documentFileHandle,d),j=w.rows.slice(x,x+c),y=[];for(var b of j){var k=(await m(l,v,d,[b]))[0];y.push(k)}var P=e(y);return{documents:y,checkpoint:P?{id:P[s.primaryPath],lwt:P._meta.lwt}:p}}